<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPA Schedule</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1, h2, h3 {
            color: #333;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ccc;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
            margin-bottom: -1px;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        
        .staff-category {
            margin-bottom: 30px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .data-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .data-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .cell-x {
            background-color: #ffecec;
        }
        
        .cell-xr {
            background-color: #fff2cc;
        }
        
        .cell-sick {
            background-color: #ead1dc;
        }
        
        .cell-hol {
            background-color: #d9ead3;
        }
        
        .cell-tr {
            background-color: #d0e0e3;
        }
        
        .loc-east {
            background-color: #93C47D;
        }
        
        .loc-rlh {
            background-color: #4A86E8;
        }
        
        .loc-bankside {
            background-color: #B7B7B7;
        }
        
        .loc-sick {
            background-color: #FF0000;
            color: white;
            font-weight: bold;
        }
        
        .legend {
            margin-top: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .legend-item {
            display: inline-block;
            margin-right: 20px;
        }
        
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
            border: 1px solid #ccc;
        }
        
        .file-input {
            margin-bottom: 20px;
        }
        
        .loading {
            display: none;
            margin: 20px 0;
            font-style: italic;
            color: #666;
        }
        
        .analytics-section {
            margin-bottom: 30px;
        }
        
        #staffHoursTable th, #locationHoursTable th, #positionHoursTable th {
            background-color: #e6e6e6;
        }
        
        #staffHoursTable td, #locationHoursTable td, #positionHoursTable td {
            text-align: center;
        }
        
        #staffHoursTable td:first-child, #locationHoursTable td:first-child, #positionHoursTable td:first-child {
            text-align: left;
            font-weight: bold;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .spa-location {
            display: none;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .spa-location.active {
            display: block;
        }
        
        .print-btn, .file-upload {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            margin-right: 10px;
        }
        
        .lara-juanita-btn {
            background-color: #e91e63;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            margin-right: 10px;
        }
        
        .lara-juanita-btn:hover {
            background-color: #c2185b;
        }
        
        .week-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .week-btn {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .week-btn.active {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        
        .position-label {
            font-size: 0.8em;
            color: #777;
            display: block;
        }
        
        .print-btn:hover, .file-upload:hover {
            background-color: #45a049;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .file-input {
            position: absolute;
            left: -9999px;
        }
        
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            display: none;
        }
        
        .status.success {
            background-color: #d9ead3;
            color: #2d6a4f;
            display: block;
        }
        
        .status.error {
            background-color: #ffecec;
            color: #b71c1c;
            display: block;
        }
        
        @media print {
            .tabs, .print-btn, .week-selector, .controls, .status, .file-upload {
                display: none;
            }
            .spa-location {
                display: block;
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 20px;
                box-shadow: none;
            }
            body {
                background-color: #fff;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SPA Schedule</h1>
        
        <div id="statusMessage" class="status"></div>
        <div id="loading" class="loading">Loading data</div>
        
        <div class="controls">
            <label for="fileInput" class="file-upload">Upload Excel File</label>
            <input type="file" id="fileInput" class="file-input" accept=".xlsx, .xls">
            <button class="print-btn" onclick="window.print()">Print Schedule</button>
            <button class="lara-juanita-btn" onclick="loadDefaultFile()">Button for Lara and Juanita</button>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="openLocation(event, 'east')">East SPA</div>
            <div class="tab" onclick="openLocation(event, 'rlh')">RLH SPA</div>
            <div class="tab" onclick="openLocation(event, 'bankside')">Bankside SPA</div>
            <div class="tab" onclick="openLocation(event, 'guests')">Guest Staff</div>
            <div class="tab" onclick="openLocation(event, 'analytics')">Analytics</div>
        </div>
        
        <!-- East SPA Tab -->
        <div id="east-tab" class="tab-content">
            <h2>East SPA</h2>
            
            <!-- East Administrators -->
            <div class="staff-category">
                <h3>Administrators</h3>
                <table id="eastAdmins" class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Member</th>
                            <!-- Days will be inserted here -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <!-- East Spa Attendance -->
            <div class="staff-category">
                <h3>Spa Attendance</h3>
                <table id="eastAttendance" class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Member</th>
                            <!-- Days will be inserted here -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <!-- East Therapists -->
            <div class="staff-category">
                <h3>Therapists</h3>
                <table id="eastTherapists" class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Member</th>
                            <!-- Days will be inserted here -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- RLH SPA Tab -->
        <div id="rlh-tab" class="tab-content">
            <h2>RLH SPA</h2>
            
            <!-- RLH Administrators -->
            <div class="staff-category">
                <h3>Administrators</h3>
                <table id="rlhAdmins" class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Member</th>
                            <!-- Days will be inserted here -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <!-- RLH Spa Attendance -->
            <div class="staff-category">
                <h3>Spa Attendance</h3>
                <table id="rlhAttendance" class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Member</th>
                            <!-- Days will be inserted here -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <!-- RLH Therapists -->
            <div class="staff-category">
                <h3>Therapists</h3>
                <table id="rlhTherapists" class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Member</th>
                            <!-- Days will be inserted here -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Bankside SPA Tab -->
        <div id="bankside-tab" class="tab-content">
            <h2>Bankside SPA</h2>
            
            <!-- Bankside Administrators -->
            <div class="staff-category">
                <h3>Administrators</h3>
                <table id="banksideAdmins" class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Member</th>
                            <!-- Days will be inserted here -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Bankside Spa Attendance -->
            <div class="staff-category">
                <h3>Spa Attendance</h3>
                <table id="banksideAttendance" class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Member</th>
                            <!-- Days will be inserted here -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Guest Staff Tab -->
        <div id="guests-tab" class="tab-content">
            <h2>Guest Staff</h2>
            <table id="allGuestStaff" class="data-table">
                <thead>
                    <tr>
                        <th>Staff Member</th>
                        <th>Home Location</th>
                        <th>Position</th>
                        <th>Working At</th>
                        <!-- Days will be inserted here -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here -->
                </tbody>
            </table>
        </div>
        
        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content">
            <h2>Analytics</h2>
            
            <!-- Staff Hours Table -->
            <div class="analytics-section">
                <h3>Staff Hours</h3>
                <table id="staffHoursTable" class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Member</th>
                            <th>Position</th>
                            <th>Home Location</th>
                            <th>Total Hours</th>
                            <th>Home Hours</th>
                            <th>Guest Hours</th>
                            <th>East Hours</th>
                            <th>RLH Hours</th>
                            <th>Bankside Hours</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Location Hours Table -->
            <div class="analytics-section">
                <h3>Location Hours</h3>
                <table id="locationHoursTable" class="data-table">
                    <thead>
                        <tr>
                            <th>Location</th>
                            <th>Total Hours</th>
                            <th>Home Staff Hours</th>
                            <th>Guest Staff Hours</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Position Hours Table -->
            <div class="analytics-section">
                <h3>Position Hours</h3>
                <table id="positionHoursTable" class="data-table">
                    <thead>
                        <tr>
                            <th>Position</th>
                            <th>Total Hours</th>
                            <th>East Hours</th>
                            <th>RLH Hours</th>
                            <th>Bankside Hours</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="legend">
            <h4>Legend:</h4>
            <div class="legend-section">
                <span class="legend-item">X - day off</span>
                <span class="legend-item">XR - day off request</span>
                <span class="legend-item">HOL - holiday</span>
                <span class="legend-item">TR - training</span>
                <span class="legend-item">sick - illness ü§í</span>
            </div>
            
            <h4>Location color codes:</h4>
            <div class="legend-section">
                <span class="legend-item"><span style="display: inline-block; width: 20px; height: 20px; background-color: #93C47D; vertical-align: middle; margin-right: 5px;"></span> EAST SPA</span>
                <span class="legend-item"><span style="display: inline-block; width: 20px; height: 20px; background-color: #4A86E8; vertical-align: middle; margin-right: 5px;"></span> RLH SPA</span>
                <span class="legend-item"><span style="display: inline-block; width: 20px; height: 20px; background-color: #B7B7B7; vertical-align: middle; margin-right: 5px;"></span> Bankside SPA</span>
            </div>
            
            <h4>Staff types:</h4>
            <div class="legend-section">
                <span class="legend-item"><span style="display: inline-block; width: 20px; height: 20px; background-color: #ffefd5; vertical-align: middle; margin-right: 5px;"></span> Senior Supervisor</span>
                <span class="legend-item"><span style="display: inline-block; width: 20px; height: 20px; background-color: #e6f7ff; vertical-align: middle; margin-right: 5px;"></span> Senior Receptionist</span>
            </div>
            
            <h4>Guest staff information:</h4>
            <div class="legend-section">
                <p>Guest staff are personnel temporarily working at a location other than their home location. 
                In the "Guest Staff" table, you can see who is working at a different location and on which days. 
                The cell color indicates which location the staff member is working at on that day.</p>
            </div>
        </div>
    </div>

    <script>
        // Configuration for staff
        const staffConfig = {
            seniorSupervisors: ["Larysa", "Umarin"],
            seniorReceptionists: ["Tanvi"],
            eastReceptionists: ["Larysa", "Ioana", "Vadym", "Fatimah"],
            eastAttendance: ["Alex", "Nandini", "Sakshi", "Dhruva", "Harshie", "Rajvee", "Apoorva"],
            eastTherapists: ["Agata", "Carmilla", "Andrea", "Simone", "Isabella", "Prem", "Siobhan", "Chris", "Sophie", "Iskra"],
            rlhReceptionists: ["Tanvi", "Umarin"],
            rlhAttendance: ["Veska", "Maksim", "Malcan", "Dipali", "Arpit", "Rashmi"],
            rlhTherapists: ["Umarin", "Shiv", "Bea", "Christine", "Guido", "Sara", "Mihaela", "Ashley", "Aldona"],
            banksideReceptionists: ["Aditya", "Naveen"],
            banksideAttendance: ["Elisa", "Fatim*"]
        };
        
        // Location colors in RGB format
        const locationColors = {
            "East": "93c47d", // Green
            "RLH": "4a86e8",  // Blue
            "Bankside": "b7b7b7", // Gray
            "Sick": "ff0000" // Red
        };
        
        // –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        const guestStaffHome = {
            "Larysa": "East",
            "Umarin": "RLH",
            "Shiv": "RLH",
            "Ashley": "RLH",
            "Guido": "RLH"
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ —è—á–µ–π–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è
        function getCellClass(value) {
            if (!value) return "";
            
            value = String(value).trim();
            
            if (value === "X") return "cell-x";
            if (value === "XR") return "cell-xr";
            if (value === "sick") return "cell-sick";
            if (value === "HOL") return "cell-hol";
            if (value === "TR") return "cell-tr";
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ü–≤–µ—Ç –ª–æ–∫–∞—Ü–∏–∏
            if (value.startsWith("east-")) return "loc-east";
            if (value.startsWith("rlh-")) return "loc-rlh";
            if (value.startsWith("bankside-")) return "loc-bankside";
            
            return "";
        }
        
        // Function to open location tab
        function openLocation(evt, locationName) {
            // Hide all tab content
            const tabContent = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContent.length; i++) {
                tabContent[i].style.display = "none";
            }
            
            // Remove active class from all tabs
            const tabs = document.getElementsByClassName("tab");
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            
            // Show the selected tab content and add active class to the button
            if (locationName === 'east') {
                document.getElementById("east-tab").style.display = "block";
            } else if (locationName === 'rlh') {
                document.getElementById("rlh-tab").style.display = "block";
            } else if (locationName === 'bankside') {
                document.getElementById("bankside-tab").style.display = "block";
            } else if (locationName === 'guests') {
                document.getElementById("guests-tab").style.display = "block";
            } else if (locationName === 'analytics') {
                document.getElementById("analytics-tab").style.display = "block";
            }
            
            evt.currentTarget.className += " active";
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
        function updateTableHeaders(tableId, headings, includeLocation = false) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const headerRow = table.querySelector("thead tr");
            if (!headerRow) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –æ—Å—Ç–∞–≤–∏—Ç—å (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç–∞–±–ª–∏—Ü—ã)
            const isGuestTable = tableId === "allGuestStaff";
            const keepColumns = isGuestTable ? 4 : (includeLocation ? 2 : 1);
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏, –∫—Ä–æ–º–µ –±–∞–∑–æ–≤—ã—Ö
            while (headerRow.children.length > keepColumns) {
                headerRow.removeChild(headerRow.lastChild);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
            for (const heading of headings) {
                const th = document.createElement("th");
                th.textContent = heading;
                headerRow.appendChild(th);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ
        function clearTableData(tableId) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const tbody = table.querySelector("tbody");
            if (!tbody) return;
            
            tbody.innerHTML = "";
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–º—è –∏–º–µ–Ω–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
        function isStaffMember(name, staffList) {
            // –ò–Ω–æ–≥–¥–∞ –∏–º–µ–Ω–∞ –º–æ–≥—É—Ç –±—ã—Ç—å —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –æ—Ç–ª–∏—á–∏—è–º–∏, –ø—Ä–æ–≤–µ—Ä—è–µ–º —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            for (const staffName of staffList) {
                if (name.includes(staffName) || staffName.includes(name)) {
                    return true;
                }
            }
            return false;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Excel-—Ñ–∞–π–ª–∞
        async function handleExcelFile(file) {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('statusMessage').className = 'status';
                document.getElementById('statusMessage').textContent = '';
                
                console.log("Starting Excel file processing...");
                
                const arrayBuffer = await file.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array', cellStyles: true });
                
                // Get the first sheet
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                console.log("Sheet loaded:", firstSheetName);
                
                // Extract cell colors
                const cellColors = extractCellColors(worksheet);
                
                // Save colors in a global variable for access from other functions
                window.excelCellColors = cellColors;
                
                // Convert to JSON
                const data = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: null, cellStyles: true });
                
                console.log("Data converted to JSON, rows:", data.length);
                
                // Analyze data structure
                displayData(data);
                
                document.getElementById('statusMessage').className = 'status success';
                document.getElementById('statusMessage').textContent = 'Data successfully loaded!';
            } catch (error) {
                console.error('Error processing file:', error);
                document.getElementById('statusMessage').className = 'status error';
                document.getElementById('statusMessage').textContent = 'Error loading file: ' + error.message;
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // Function to display data
        function displayData(data) {
            // Save data for later reference
            window.lastLoadedData = data;
            
            // Find row with days of the week and dates
            const headerInfo = findHeaderInfo(data);
            
            if (!headerInfo || !headerInfo.dayColumns || headerInfo.dayColumns.length === 0) {
                throw new Error("Could not find week information");
            }
            
            // Form headings
            const headings = headerInfo.dayColumns.map((col, index) => {
                const day = data[headerInfo.dayRowIndex][col];
                let date = '';
                
                if (headerInfo.dateRowIndex >= 0 && headerInfo.dateRowIndex < data.length) {
                    date = data[headerInfo.dateRowIndex][col];
                }
                
                if (date) {
                    return `${day}, ${date}`;
                } else {
                    return day;
                }
            });
            
            // Update headings in all tables
            updateTableHeaders("eastAdmins", headings);
            updateTableHeaders("eastAttendance", headings);
            updateTableHeaders("eastTherapists", headings);
            updateTableHeaders("rlhAdmins", headings);
            updateTableHeaders("rlhAttendance", headings);
            updateTableHeaders("rlhTherapists", headings);
            updateTableHeaders("banksideAdmins", headings);
            updateTableHeaders("banksideAttendance", headings);
            updateTableHeaders("allGuestStaff", headings, true);
            
            // Find locations
            const sections = findSections(data);
            
            // Clear all tables
            clearAllTables();
            
            // Create arrays to store all staff by category
            const allStaffByCategory = {
                eastAdmins: [],
                eastAttendance: [],
                eastTherapists: [],
                rlhAdmins: [],
                rlhAttendance: [],
                rlhTherapists: [],
                banksideAdmins: [],
                banksideAttendance: []
            };
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –∏—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
            const allFoundStaff = {};
            
            // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö
            for (let i = 0; i < data.length; i++) {
                if (!data[i] || !data[i][0] || typeof data[i][0] !== 'string') continue;
                
                const rowStaffName = data[i][0].trim();
                
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                if (rowStaffName === "" || 
                    rowStaffName.toUpperCase().includes("RECEPTION") || 
                    rowStaffName.toUpperCase().includes("ATTENDANCE") || 
                    rowStaffName.toUpperCase().includes("THERAPISTS")) {
                    continue;
                }
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º –±–∞–∑–æ–≤–æ–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–±–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Å–∫–æ–±–∫–∞—Ö)
                let baseStaffName = rowStaffName;
                const bracketIndex = rowStaffName.indexOf('(');
                if (bracketIndex > 0) {
                    baseStaffName = rowStaffName.substring(0, bracketIndex).trim();
                }
                
                // –°–æ–±–∏—Ä–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –¥–Ω–µ–π
                const schedule = [];
                
                for (let j = 0; j < headerInfo.dayColumns.length; j++) {
                    const col = headerInfo.dayColumns[j];
                    if (col < data[i].length) {
                        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —è—á–µ–π–∫–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –µ–≥–æ –≤ —Å—Ç—Ä–æ–∫—É
                        let cellValue = data[i][col];
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–≤–µ—Ç —è—á–µ–π–∫–∏
                        let isSick = false;
                        const colLetter = String.fromCharCode(65 + col);
                        const rowNumber = i + 1;
                        const cellAddress = `${colLetter}${rowNumber}`;
                        
                        if (window.excelCellColors && window.excelCellColors[cellAddress]) {
                            const cellColor = window.excelCellColors[cellAddress].toLowerCase();
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ü–≤–µ—Ç –∫—Ä–∞—Å–Ω—ã–º (#FF0000)
                            if (cellColor === locationColors.Sick.toLowerCase() || isSimilarColor(cellColor, locationColors.Sick)) {
                                isSick = true;
                                console.log(`–ù–∞–π–¥–µ–Ω–∞ —è—á–µ–π–∫–∞ —Å –∫—Ä–∞—Å–Ω—ã–º —Ñ–æ–Ω–æ–º (${cellColor}) –≤ ${cellAddress} –¥–ª—è ${rowStaffName}, –¥–µ–Ω—å ${j}`);
                            }
                        }
                        
                        // –ï—Å–ª–∏ —è—á–µ–π–∫–∞ –∫—Ä–∞—Å–Ω–∞—è, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ "sick" –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
                        if (isSick) {
                            schedule.push("sick");
                        }
                        // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —è—á–µ–π–∫–∏
                        else if (cellValue !== null && cellValue !== undefined) {
                            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
                            schedule.push(String(cellValue));
                        } else {
                            schedule.push("");
                        }
                    } else {
                        schedule.push("");
                    }
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏ –µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                allFoundStaff[rowStaffName] = {
                    name: rowStaffName,
                    baseName: baseStaffName, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–∑–æ–≤–æ–µ –∏–º—è –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                    schedule: schedule,
                    row: i
                };
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–≤–µ—Ç–∞ —è—á–µ–µ–∫ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π
                if (window.excelCellColors) {
                    const shifts = [];
                    
                    for (let j = 0; j < headerInfo.dayColumns.length; j++) {
                        const col = headerInfo.dayColumns[j];
                        const colLetter = String.fromCharCode(65 + col);
                        const rowNumber = i + 1;
                        const cellAddress = `${colLetter}${rowNumber}`;
                        
                        if (window.excelCellColors[cellAddress]) {
                            const cellColor = window.excelCellColors[cellAddress].toLowerCase();
                            let shiftLocation = null;
                            
                            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é –ø–æ —Ü–≤–µ—Ç—É
                            if (cellColor === locationColors.East.toLowerCase()) {
                                shiftLocation = "East";
                            } else if (cellColor === locationColors.RLH.toLowerCase()) {
                                shiftLocation = "RLH";
                            } else if (cellColor === locationColors.Bankside.toLowerCase()) {
                                shiftLocation = "Bankside";
                            } else if (isSimilarColor(cellColor, locationColors.East)) {
                                shiftLocation = "East";
                            } else if (isSimilarColor(cellColor, locationColors.RLH)) {
                                shiftLocation = "RLH";
                            } else if (isSimilarColor(cellColor, locationColors.Bankside)) {
                                shiftLocation = "Bankside";
                            }
                            
                            if (shiftLocation) {
                                shifts.push({
                                    day: j,
                                    location: shiftLocation
                                });
                            }
                        }
                    }
                    
                    if (shifts.length > 0) {
                        allFoundStaff[rowStaffName].shifts = shifts;
                    }
                }
            }
            
            // –¢–µ–ø–µ—Ä—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            for (const staffName of Object.keys(allFoundStaff)) {
                const staff = allFoundStaff[staffName];
                const baseStaffName = staff.baseName;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫ –∫–∞–∫–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –º–æ–∂–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                
                // East Receptionists
                if (staffConfig.eastReceptionists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName))) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                    if (!allStaffByCategory.eastAdmins.some(s => s.baseName === staff.baseName || 
                        (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                        allStaffByCategory.eastAdmins.push(staff);
                    }
                }
                
                // East Attendance
                if (staffConfig.eastAttendance.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName))) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                    if (!allStaffByCategory.eastAttendance.some(s => s.baseName === staff.baseName || 
                        (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                        allStaffByCategory.eastAttendance.push(staff);
                    }
                }
                
                // East Therapists
                if (staffConfig.eastTherapists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName))) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                    if (!allStaffByCategory.eastTherapists.some(s => s.baseName === staff.baseName || 
                        (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                        allStaffByCategory.eastTherapists.push(staff);
                    }
                }
                
                // RLH Receptionists
                if (staffConfig.rlhReceptionists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName))) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                    if (!allStaffByCategory.rlhAdmins.some(s => s.baseName === staff.baseName || 
                        (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                        allStaffByCategory.rlhAdmins.push(staff);
                    }
                }
                
                // RLH Attendance
                if (staffConfig.rlhAttendance.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName))) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                    if (!allStaffByCategory.rlhAttendance.some(s => s.baseName === staff.baseName || 
                        (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                        allStaffByCategory.rlhAttendance.push(staff);
                    }
                }
                
                // RLH Therapists
                if (staffConfig.rlhTherapists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName))) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                    if (!allStaffByCategory.rlhTherapists.some(s => s.baseName === staff.baseName || 
                        (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                        allStaffByCategory.rlhTherapists.push(staff);
                    }
                }
                
                // Bankside Receptionists
                if (staffConfig.banksideReceptionists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName))) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                    if (!allStaffByCategory.banksideAdmins.some(s => s.baseName === staff.baseName || 
                        (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                        allStaffByCategory.banksideAdmins.push(staff);
                    }
                }
                
                // Bankside Attendance
                if (staffConfig.banksideAttendance.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName))) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                    if (!allStaffByCategory.banksideAttendance.some(s => s.baseName === staff.baseName || 
                        (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                        allStaffByCategory.banksideAttendance.push(staff);
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å–º–µ–Ω—ã –≤ –¥—Ä—É–≥–∏—Ö –ª–æ–∫–∞—Ü–∏—è—Ö
                if (allFoundStaff[staffName].shifts) {
                    const shifts = allFoundStaff[staffName].shifts;
                    const locations = new Set(shifts.map(shift => shift.location));
                    const staff = allFoundStaff[staffName];
                    const baseStaffName = staff.baseName;
                    
                    // –ï—Å–ª–∏ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –µ—Å—Ç—å —Å–º–µ–Ω—ã –≤ East, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    if (locations.has("East")) {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤ –∫–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                        if (staffConfig.eastReceptionists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) && 
                            !allStaffByCategory.eastAdmins.some(s => s.baseName === staff.baseName || 
                            (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                            allStaffByCategory.eastAdmins.push(staff);
                        } else if (staffConfig.eastAttendance.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) && 
                            !allStaffByCategory.eastAttendance.some(s => s.baseName === staff.baseName || 
                            (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                            allStaffByCategory.eastAttendance.push(staff);
                        } else if (staffConfig.eastTherapists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) && 
                            !allStaffByCategory.eastTherapists.some(s => s.baseName === staff.baseName || 
                            (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                            allStaffByCategory.eastTherapists.push(staff);
                        }
                    }
                    
                    // –ï—Å–ª–∏ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –µ—Å—Ç—å —Å–º–µ–Ω—ã –≤ RLH, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    if (locations.has("RLH")) {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤ –∫–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                        if (staffConfig.rlhReceptionists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) && 
                            !allStaffByCategory.rlhAdmins.some(s => s.baseName === staff.baseName || 
                            (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                            allStaffByCategory.rlhAdmins.push(staff);
                        } else if (staffConfig.rlhAttendance.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) && 
                            !allStaffByCategory.rlhAttendance.some(s => s.baseName === staff.baseName || 
                            (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                            allStaffByCategory.rlhAttendance.push(staff);
                        } else if (staffConfig.rlhTherapists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) && 
                            !allStaffByCategory.rlhTherapists.some(s => s.baseName === staff.baseName || 
                            (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                            allStaffByCategory.rlhTherapists.push(staff);
                        }
                    }
                    
                    // –ï—Å–ª–∏ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –µ—Å—Ç—å —Å–º–µ–Ω—ã –≤ Bankside, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    if (locations.has("Bankside")) {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤ –∫–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                        if (staffConfig.banksideReceptionists.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) && 
                            !allStaffByCategory.banksideAdmins.some(s => s.baseName === staff.baseName || 
                            (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                            allStaffByCategory.banksideAdmins.push(staff);
                        } else if (staffConfig.banksideAttendance.some(name => name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) && 
                            !allStaffByCategory.banksideAttendance.some(s => s.baseName === staff.baseName || 
                            (s.baseName && staff.baseName && (s.baseName.includes(staff.baseName) || staff.baseName.includes(s.baseName))))) {
                            allStaffByCategory.banksideAttendance.push(staff);
                        }
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö
            // –ï—Å–ª–∏ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö —Å –ø—É—Å—Ç—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            function ensureStaffInCategory(staffList, category) {
                for (const staffName of staffList) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    const found = allStaffByCategory[category].some(staff => {
                        // –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤–æ–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–±–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Å–∫–æ–±–∫–∞—Ö)
                        let baseStaffName = staff.name;
                        if (staff.baseName) {
                            baseStaffName = staff.baseName;
                        } else {
                            const bracketIndex = staff.name.indexOf('(');
                            if (bracketIndex > 0) {
                                baseStaffName = staff.name.substring(0, bracketIndex).trim();
                            }
                        }
                        
                        return baseStaffName === staffName || 
                               baseStaffName.includes(staffName) || 
                               staffName.includes(baseStaffName);
                    });
                    
                    // –ï—Å–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ —Å –ø—É—Å—Ç—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
                    if (!found) {
                        console.log(`–î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ${staffName} –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ${category}`);
                        
                        // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏
                        const schedule = new Array(headerInfo.dayColumns.length).fill("");
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                        allStaffByCategory[category].push({
                            name: staffName,
                            baseName: staffName, // –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤–æ–µ –∏–º—è
                            schedule: schedule
                        });
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            ensureStaffInCategory(staffConfig.eastReceptionists, "eastAdmins");
            ensureStaffInCategory(staffConfig.eastAttendance, "eastAttendance");
            ensureStaffInCategory(staffConfig.eastTherapists, "eastTherapists");
            ensureStaffInCategory(staffConfig.rlhReceptionists, "rlhAdmins");
            ensureStaffInCategory(staffConfig.rlhAttendance, "rlhAttendance");
            ensureStaffInCategory(staffConfig.rlhTherapists, "rlhTherapists");
            ensureStaffInCategory(staffConfig.banksideReceptionists, "banksideAdmins");
            ensureStaffInCategory(staffConfig.banksideAttendance, "banksideAttendance");
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã–º–∏
            for (const category in allStaffByCategory) {
                if (allStaffByCategory[category].length > 0) {
                    populateStaffTable(category, allStaffByCategory[category], headerInfo);
                }
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            const guestStaff = findAllGuestStaff(data, headerInfo);
            populateAllGuestStaffTable("allGuestStaff", guestStaff, headings);
            
            // Calculate and display analytics
            calculateAndDisplayAnalytics(allStaffByCategory, guestStaff, headerInfo);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–Ω—è—Ö –Ω–µ–¥–µ–ª–∏ –∏ –¥–∞—Ç–∞—Ö
        function findHeaderInfo(data) {
            // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –¥–Ω—è–º–∏ –Ω–µ–¥–µ–ª–∏
            let dayRowIndex = -1;
            let dayColumns = [];
            
            // –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –∏ —Ä—É—Å—Å–∫–æ–º
            const dayNames = [
                "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday",
                "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun",
                "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ", 
                "–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"
            ];
            
            // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –¥–Ω—è–º–∏ –Ω–µ–¥–µ–ª–∏
            for (let i = 0; i < Math.min(10, data.length); i++) {
                if (!data[i]) continue;
                
                const foundDays = [];
                for (let j = 0; j < data[i].length; j++) {
                    const cell = data[i][j];
                    if (cell && typeof cell === 'string' && dayNames.includes(cell.trim())) {
                        foundDays.push(j);
                    }
                }
                
                if (foundDays.length >= 5) { // –ù–∞—à–ª–∏ –º–∏–Ω–∏–º—É–º 5 –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
                    dayRowIndex = i;
                    dayColumns = foundDays;
                    break;
                }
            }
            
            if (dayRowIndex === -1) {
                return null;
            }
            
            // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –¥–∞—Ç–∞–º–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ—Å–ª–µ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏)
            let dateRowIndex = -1;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
            if (dayRowIndex + 1 < data.length) {
                const nextRow = data[dayRowIndex + 1];
                if (nextRow) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Å—Ç—Ä–æ–∫–∞ —á–∏—Å–ª–∞
                    let hasNumbers = false;
                    for (const col of dayColumns) {
                        if (col < nextRow.length && nextRow[col] !== null && 
                            (typeof nextRow[col] === 'number' || 
                             (typeof nextRow[col] === 'string' && !isNaN(parseInt(nextRow[col]))))) {
                            hasNumbers = true;
                            break;
                        }
                    }
                    
                    if (hasNumbers) {
                        dateRowIndex = dayRowIndex + 1;
                    }
                }
            }
            
            return {
                dayRowIndex,
                dayColumns,
                dateRowIndex
            };
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–µ–∫—Ü–∏–π –ª–æ–∫–∞—Ü–∏–π
        function findSections(data) {
            const sections = {
                eastReception: -1,
                eastAttend: -1,
                eastTher: -1,
                rlhReception: -1,
                rlhAttend: -1,
                rlhTher: -1,
                banksideReception: -1,
                bankside: -1
            };
            
            for (let i = 0; i < data.length; i++) {
                if (!data[i] || !data[i][0] || typeof data[i][0] !== 'string') continue;
                
                const marker = data[i][0].trim().toUpperCase();
                
                if (marker.includes("EAST RECEPTION")) {
                    sections.eastReception = i;
                } else if (marker.includes("EAST ATTENDANCE")) {
                    sections.eastAttend = i;
                } else if (marker.includes("EAST THERAPISTS") || marker.includes("EAST THER")) {
                    sections.eastTher = i;
                } else if (marker.includes("RLH RECEPTION")) {
                    sections.rlhReception = i;
                } else if (marker.includes("RLH ATTENDANCE") || marker.includes("RLH ATTEND")) {
                    sections.rlhAttend = i;
                } else if (marker.includes("RLH THERAPISTS") || marker.includes("RLH THERAP") || marker.includes("RLH THER")) {
                    sections.rlhTher = i;
                } else if (marker.includes("BANKSIDE RECEPTION") || marker.includes("BANKSIDE R")) {
                    sections.banksideReception = i;
                } else if (marker.includes("BANKSIDE ATTENDANCE") || (marker.includes("BANKSIDE") && !marker.includes("RECEPTION"))) {
                    sections.bankside = i;
                }
            }
            
            return sections;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        function extractStaffData(data, sectionIndex, staffList, dayColumns) {
            const result = [];
            
            // –ò—â–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 30 —Å—Ç—Ä–æ–∫ –æ—Ç –Ω–∞—á–∞–ª–∞ —Å–µ–∫—Ü–∏–∏
            for (let i = sectionIndex + 1; i < Math.min(sectionIndex + 30, data.length); i++) {
                if (!data[i] || !data[i][0] || typeof data[i][0] !== 'string') continue;
                
                const staffName = data[i][0].trim();
                
                // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Å–ª–µ–¥—É—é—â—É—é —Å–µ–∫—Ü–∏—é, –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –ø–æ–∏—Å–∫
                if (staffName.toUpperCase().includes("RECEPTION") || 
                    staffName.toUpperCase().includes("ATTENDANCE") || 
                    staffName.toUpperCase().includes("THERAPISTS") || 
                    staffName.includes("(")) {
                    break;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Ö–æ–¥–∏—Ç –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤ —Ü–µ–ª–µ–≤–æ–π —Å–ø–∏—Å–æ–∫
                let isInStaffList = false;
                for (const name of staffList) {
                    if (staffName.includes(name) || name.includes(staffName)) {
                        isInStaffList = true;
                        break;
                    }
                }
                
                if (isInStaffList || staffName.includes("(")) {
                    // –°–æ–±–∏—Ä–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –¥–Ω–µ–π
                    const schedule = [];
                    
                    for (const col of dayColumns) {
                        if (col < data[i].length) {
                            schedule.push(data[i][col] !== null ? String(data[i][col]) : "");
                        } else {
                            schedule.push("");
                        }
                    }
                    
                    result.push({
                        name: staffName,
                        schedule: schedule
                    });
                }
            }
            
            return result;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —à—Ç–∞—Ç–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        function getStaffHomeLocation(staffName) {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –±–∞–∑–æ–≤–æ–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–±–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Å–∫–æ–±–∫–∞—Ö)
            let baseStaffName = staffName;
            const bracketIndex = staffName.indexOf('(');
            if (bracketIndex > 0) {
                baseStaffName = staffName.substring(0, bracketIndex).trim();
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –±–∞–∑–æ–≤–æ–º—É –∏–º–µ–Ω–∏
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤ –∫–∞–∫–æ–π –ª–æ–∫–∞—Ü–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
            for (const name of staffConfig.eastReceptionists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "East";
                }
            }
            
            for (const name of staffConfig.eastAttendance) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "East";
                }
            }
            
            for (const name of staffConfig.eastTherapists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "East";
                }
            }
            
            for (const name of staffConfig.rlhReceptionists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "RLH";
                }
            }
            
            for (const name of staffConfig.rlhAttendance) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "RLH";
                }
            }
            
            for (const name of staffConfig.rlhTherapists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "RLH";
                }
            }
            
            for (const name of staffConfig.banksideReceptionists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Bankside";
                }
            }
            
            for (const name of staffConfig.banksideAttendance) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Bankside";
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–ø–∏—Å–∫–∞—Ö
            return "";
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        function getStaffPosition(staffName) {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –±–∞–∑–æ–≤–æ–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–±–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Å–∫–æ–±–∫–∞—Ö)
            let baseStaffName = staffName;
            const bracketIndex = staffName.indexOf('(');
            if (bracketIndex > 0) {
                baseStaffName = staffName.substring(0, bracketIndex).trim();
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –±–∞–∑–æ–≤–æ–º—É –∏–º–µ–Ω–∏
            for (const name of staffConfig.seniorSupervisors) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Senior Supervisor";
                }
            }
            
            for (const name of staffConfig.seniorReceptionists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Senior Receptionist";
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
            for (const name of staffConfig.eastReceptionists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Receptionist";
                }
            }
            
            for (const name of staffConfig.rlhReceptionists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Receptionist";
                }
            }
            
            for (const name of staffConfig.banksideReceptionists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Receptionist";
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ spa attendance
            for (const name of staffConfig.eastAttendance) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Spa Attendance";
                }
            }
            
            for (const name of staffConfig.rlhAttendance) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Spa Attendance";
                }
            }
            
            for (const name of staffConfig.banksideAttendance) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Spa Attendance";
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Ç–µ—Ä–∞–ø–µ–≤—Ç–æ–º
            for (const name of staffConfig.eastTherapists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Therapist";
                }
            }
            
            for (const name of staffConfig.rlhTherapists) {
                if (name === baseStaffName || baseStaffName.includes(name) || name.includes(baseStaffName)) {
                    return "Therapist";
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–ø–∏—Å–∫–∞—Ö
            return "Unknown";
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –Ω–µ –≤ —Å–≤–æ–µ–π –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏)
        function findAllGuestStaff(data, headerInfo) {
            const result = [];
            const dayColumns = headerInfo.dayColumns;
            
            // –ü–µ—Ä–µ—á–µ–Ω—å –≤—Å–µ—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            const allStaff = new Set([
                ...staffConfig.eastReceptionists,
                ...staffConfig.eastAttendance,
                ...staffConfig.eastTherapists,
                ...staffConfig.rlhReceptionists,
                ...staffConfig.rlhAttendance,
                ...staffConfig.rlhTherapists,
                ...staffConfig.banksideReceptionists,
                ...staffConfig.banksideAttendance
            ]);
            
            // –¶–≤–µ—Ç–∞ –ª–æ–∫–∞—Ü–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ RGB
            const locationColors = {
                "East": "93c47d", // –ó–µ–ª–µ–Ω—ã–π
                "RLH": "4a86e8",  // –°–∏–Ω–∏–π
                "Bankside": "b7b7b7", // –°–µ—Ä—ã–π
                "Sick": "ff0000" // –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è sick
            };
            
            console.log("–ù–∞—á–∏–Ω–∞—é –ø–æ–∏—Å–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...");
            console.log("–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ü–≤–µ—Ç–∞ –ª–æ–∫–∞—Ü–∏–π:", locationColors);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ —è—á–µ–µ–∫
            if (!window.excelCellColors || Object.keys(window.excelCellColors).length === 0) {
                console.warn("–ù–µ –Ω–∞–π–¥–µ–Ω—ã –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞ —è—á–µ–µ–∫!");
            } else {
                console.log(`–ù–∞–π–¥–µ–Ω–æ ${Object.keys(window.excelCellColors).length} —Ü–≤–µ—Ç–æ–≤ —è—á–µ–µ–∫`);
            }
            
            // –°–æ–∑–¥–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            let debugInfo = "–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:<br>";
            
            // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            for (const staffName of allStaff) {
                const homeLocation = getStaffHomeLocation(staffName);
                const position = getStaffPosition(staffName);
                
                // –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–æ–º–∞—à–Ω—é—é –ª–æ–∫–∞—Ü–∏—é, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                if (!homeLocation) {
                    console.log(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–æ–º–∞—à–Ω—é—é –ª–æ–∫–∞—Ü–∏—é –¥–ª—è ${staffName}, –ø—Ä–æ–ø—É—Å–∫–∞—é`);
                    debugInfo += `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–æ–º–∞—à–Ω—é—é –ª–æ–∫–∞—Ü–∏—é –¥–ª—è ${staffName}<br>`;
                    continue;
                }
                
                console.log(`–ü—Ä–æ–≤–µ—Ä—è—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: ${staffName}, –¥–æ–º–∞—à–Ω—è—è –ª–æ–∫–∞—Ü–∏—è: ${homeLocation}`);
                debugInfo += `<strong>–°–æ—Ç—Ä—É–¥–Ω–∏–∫ ${staffName}</strong>, –¥–æ–º–∞—à–Ω—è—è –ª–æ–∫–∞—Ü–∏—è: ${homeLocation}<br>`;
                
                // –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏ —Å —ç—Ç–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –≤ –¥–∞–Ω–Ω—ã—Ö
                let foundStaff = false;
                
                for (let i = 0; i < data.length; i++) {
                    if (!data[i] || !data[i][0] || typeof data[i][0] !== 'string') continue;
                    
                    const rowStaffName = data[i][0].trim();
                    
                    // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                    if (rowStaffName === staffName || rowStaffName.includes(staffName) || staffName.includes(rowStaffName)) {
                        foundStaff = true;
                        console.log(`–ù–∞—à–µ–ª —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ${staffName} –≤ —Å—Ç—Ä–æ–∫–µ ${i}`);
                        debugInfo += `–ù–∞–π–¥–µ–Ω –≤ —Å—Ç—Ä–æ–∫–µ ${i}<br>`;
                        
                        // –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –≤—Å–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ –∏ –∏—â–µ–º —Å–º–µ–Ω—ã –≤ –¥—Ä—É–≥–∏—Ö –ª–æ–∫–∞—Ü–∏—è—Ö –ø–æ —Ü–≤–µ—Ç—É
                        const guestShifts = [];
                        
                        for (let j = 0; j < dayColumns.length; j++) {
                            const col = dayColumns[j];
                            
                            if (col < data[i].length && data[i][col] !== null) {
                                const shift = String(data[i][col]);
                                
                                // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –≤—ã—Ö–æ–¥–Ω–æ–π –∏ –µ—Å—Ç—å —Å–º–µ–Ω–∞
                                if (shift && shift !== "X" && shift !== "XR" && 
                                    shift !== "HOL" && shift !== "TR" && shift !== "sick" && shift.trim() !== "") {
                                    
                                    console.log(`–ü—Ä–æ–≤–µ—Ä—è—é —Å–º–µ–Ω—É –¥–ª—è ${staffName}, –¥–µ–Ω—å ${j}, –∑–Ω–∞—á–µ–Ω–∏–µ: ${shift}`);
                                    debugInfo += `–î–µ–Ω—å ${j}, —Å–º–µ–Ω–∞: ${shift} - `;
                                    
                                    // –ü–æ–ª—É—á–∞–µ–º —Ü–≤–µ—Ç —è—á–µ–π–∫–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö Excel
                                    let cellColor = null;
                                    
                                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç –∏–∑ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ —è—á–µ–µ–∫
                                    if (window.excelCellColors) {
                                        // –í—ã—á–∏—Å–ª—è–µ–º –∞–¥—Ä–µ—Å —è—á–µ–π–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Excel (–Ω–∞–ø—Ä–∏–º–µ—Ä, A1, B2)
                                        const colLetter = String.fromCharCode(65 + col); // A, B, C, ...
                                        const rowNumber = i + 1; // Excel –Ω–∞—á–∏–Ω–∞–µ—Ç —Å 1
                                        const cellAddress = `${colLetter}${rowNumber}`;
                                        
                                        console.log(`–ò—â—É —Ü–≤–µ—Ç –¥–ª—è —è—á–µ–π–∫–∏ ${cellAddress}`);
                                        
                                        if (window.excelCellColors[cellAddress]) {
                                            cellColor = window.excelCellColors[cellAddress];
                                            console.log(`–ù–∞–π–¥–µ–Ω —Ü–≤–µ—Ç –¥–ª—è —è—á–µ–π–∫–∏ ${cellAddress}: ${cellColor}`);
                                            debugInfo += `—Ü–≤–µ—Ç: ${cellColor} - `;
                                        } else {
                                            debugInfo += `—Ü–≤–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ excelCellColors - `;
                                        }
                                    }
                                    
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —è—á–µ–π–∫–∞ "sick" –ø–æ —Ü–≤–µ—Ç—É –∏–ª–∏ —Ç–µ–∫—Å—Ç—É
                                    if ((cellColor && cellColor === locationColors.Sick.toLowerCase()) || shift === "sick") {
                                        // –≠—Ç–æ sick, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –≥–æ—Å—Ç–µ–≤—ã–µ —Å–º–µ–Ω—ã
                                        console.log(`${staffName} –±–æ–ª–µ–µ—Ç –≤ –¥–µ–Ω—å ${j}`);
                                        debugInfo += `–±–æ–ª–µ–µ—Ç<br>`;
                                        continue;
                                    }
                                    
                                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é –ø–æ —Ü–≤–µ—Ç—É
                                    let shiftLocation = null;
                                    
                                    if (cellColor) {
                                        console.log(`–¶–≤–µ—Ç —è—á–µ–π–∫–∏ –¥–ª—è ${staffName}, –¥–µ–Ω—å ${j}: ${cellColor}`);
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–≤–µ—Ç –Ω–∞ —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ª–æ–∫–∞—Ü–∏—è–º
                                        if (cellColor === locationColors.East.toLowerCase()) {
                                        shiftLocation = "East";
                                            debugInfo += `—Ü–≤–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç East - `;
                                        }
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º RLH (—Å–∏–Ω–∏–π)
                                        else if (cellColor === locationColors.RLH.toLowerCase()) {
                                        shiftLocation = "RLH";
                                            debugInfo += `—Ü–≤–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç RLH - `;
                                        }
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º Bankside (—Å–µ—Ä—ã–π)
                                        else if (cellColor === locationColors.Bankside.toLowerCase()) {
                                        shiftLocation = "Bankside";
                                            debugInfo += `—Ü–≤–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Bankside - `;
                                        } 
                                        // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ–µ
                                        else if (isSimilarColor(cellColor, locationColors.East)) {
                                            shiftLocation = "East";
                                            debugInfo += `—Ü–≤–µ—Ç –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç East - `;
                                        }
                                        else if (isSimilarColor(cellColor, locationColors.RLH)) {
                                            shiftLocation = "RLH";
                                            debugInfo += `—Ü–≤–µ—Ç –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç RLH - `;
                                        }
                                        else if (isSimilarColor(cellColor, locationColors.Bankside)) {
                                            shiftLocation = "Bankside";
                                            debugInfo += `—Ü–≤–µ—Ç –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Bankside - `;
                                        }
                                        else {
                                            debugInfo += `—Ü–≤–µ—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏ - `;
                                        }
                                        
                                        // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —ç—Ç–æ –Ω–µ –¥–æ–º–∞—à–Ω—è—è –ª–æ–∫–∞—Ü–∏—è
                                        if (shiftLocation && shiftLocation !== homeLocation) {
                                        guestShifts.push({
                                            day: j,
                                            shift: shift,
                                            location: shiftLocation
                                        });
                                            console.log(`${staffName} —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ ${shiftLocation} (–Ω–µ –µ–≥–æ –¥–æ–º–∞—à–Ω—è—è –ª–æ–∫–∞—Ü–∏—è)`);
                                            debugInfo += `—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ ${shiftLocation} (–Ω–µ –µ–≥–æ –¥–æ–º–∞—à–Ω—è—è –ª–æ–∫–∞—Ü–∏—è)<br>`;
                                        } else if (shiftLocation) {
                                            console.log(`${staffName} —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ ${shiftLocation} (–µ–≥–æ –¥–æ–º–∞—à–Ω—è—è –ª–æ–∫–∞—Ü–∏—è)`);
                                            debugInfo += `—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ ${shiftLocation} (–µ–≥–æ –¥–æ–º–∞—à–Ω—è—è –ª–æ–∫–∞—Ü–∏—è)<br>`;
                                        } else {
                                            console.log(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ü–≤–µ—Ç —è—á–µ–π–∫–∏ –¥–ª—è ${staffName}, –¥–µ–Ω—å ${j}: ${cellColor}`);
                                            debugInfo += `–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ü–≤–µ—Ç: ${cellColor}<br>`;
                                        }
                                    } else {
                                        console.log(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ü–≤–µ—Ç —è—á–µ–π–∫–∏ –¥–ª—è ${staffName}, –¥–µ–Ω—å ${j}`);
                                        debugInfo += `–Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ü–≤–µ—Ç<br>`;
                                    }
                                }
                            }
                        }
                        
                        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –≥–æ—Å—Ç–µ–≤–∞—è —Å–º–µ–Ω–∞
                        if (guestShifts.length > 0) {
                            console.log(`${staffName} –∏–º–µ–µ—Ç ${guestShifts.length} –≥–æ—Å—Ç–µ–≤—ã—Ö —Å–º–µ–Ω`);
                            debugInfo += `<strong>–ò—Ç–æ–≥: ${staffName} –∏–º–µ–µ—Ç ${guestShifts.length} –≥–æ—Å—Ç–µ–≤—ã—Ö —Å–º–µ–Ω</strong><br>`;
                            
                            // –°–æ–∑–¥–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –¥–Ω–µ–π
                            const schedule = new Array(dayColumns.length).fill("");
                            
                            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ—Å—Ç–µ–≤—ã–µ —Å–º–µ–Ω—ã
                            for (const { day, shift } of guestShifts) {
                                schedule[day] = shift;
                            }
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                            result.push({
                                name: staffName,
                                homeLocation: homeLocation,
                                position: position,
                                guestLocation: guestShifts[0].location,
                                schedule: schedule,
                                shifts: guestShifts
                            });
                            console.log(`${staffName} –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`);
                        } else {
                            console.log(`${staffName} –Ω–µ –∏–º–µ–µ—Ç –≥–æ—Å—Ç–µ–≤—ã—Ö —Å–º–µ–Ω`);
                            debugInfo += `<strong>–ò—Ç–æ–≥: ${staffName} –Ω–µ –∏–º–µ–µ—Ç –≥–æ—Å—Ç–µ–≤—ã—Ö —Å–º–µ–Ω</strong><br>`;
                        }
                            
                            break; // –ù–∞—à–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
                        }
                    }
                
                if (!foundStaff) {
                    debugInfo += `–°–æ—Ç—Ä—É–¥–Ω–∏–∫ ${staffName} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –¥–∞–Ω–Ω—ã—Ö<br>`;
                }
            }
            
            console.log(`–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ ${result.length} –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`);
            debugInfo += `<strong>–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ ${result.length} –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</strong><br>`;
            
            // –í—ã–≤–æ–¥–∏–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–æ–Ω—Å–æ–ª—å –≤ –≤–∏–¥–µ HTML
            console.log("%c –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º", "font-size: 16px; font-weight: bold;");
            console.log(debugInfo);
            
            // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            const debugElement = document.createElement('div');
            debugElement.id = 'debugInfo';
            debugElement.style.display = 'none';
            debugElement.style.padding = '20px';
            debugElement.style.backgroundColor = '#f9f9f9';
            debugElement.style.border = '1px solid #ddd';
            debugElement.style.margin = '20px 0';
            debugElement.style.maxHeight = '500px';
            debugElement.style.overflow = 'auto';
            debugElement.innerHTML = debugInfo;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            const debugButton = document.createElement('button');
            debugButton.textContent = 'Show Debug Information';
            debugButton.style.marginTop = '10px';
            debugButton.style.padding = '5px 10px';
            debugButton.style.backgroundColor = '#f0f0f0';
            debugButton.style.border = '1px solid #ddd';
            debugButton.style.borderRadius = '4px';
            debugButton.style.cursor = 'pointer';
            
            debugButton.onclick = function() {
                const debugElement = document.getElementById('debugInfo');
                if (debugElement.style.display === 'none') {
                    debugElement.style.display = 'block';
                    this.textContent = 'Hide Debug Information';
                } else {
                    debugElement.style.display = 'none';
                    this.textContent = 'Show Debug Information';
                }
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const container = document.querySelector('.container');
            container.appendChild(debugButton);
            container.appendChild(debugElement);
            
            return result;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã–º–∏ –æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö
        function populateAllGuestStaffTable(tableId, guestStaff, headings) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const tbody = table.querySelector("tbody");
            if (!tbody) return;
            
            // Clear the table
            tbody.innerHTML = "";
            
            // If there are no guest staff, display a message
            if (guestStaff.length === 0) {
                const tr = document.createElement("tr");
                const td = document.createElement("td");
                td.textContent = "No guest staff for this week";
                td.colSpan = 4 + headings.length; // 4 base columns + days of the week
                td.style.textAlign = "center";
                td.style.fontStyle = "italic";
                td.style.padding = "20px";
                tr.appendChild(td);
                tbody.appendChild(tr);
                return;
            }
            
            // Populate the table with data
            for (const staff of guestStaff) {
                const tr = document.createElement("tr");
                
                // Staff name
                const tdName = document.createElement("td");
                tdName.textContent = staff.name;
                tr.appendChild(tdName);
                
                // Home location
                const tdHome = document.createElement("td");
                tdHome.textContent = staff.homeLocation;
                tdHome.className = `loc-${staff.homeLocation.toLowerCase()}`;
                tr.appendChild(tdHome);
                
                // Position
                const tdPosition = document.createElement("td");
                tdPosition.textContent = staff.position;
                tr.appendChild(tdPosition);
                
                // Working at
                const tdGuest = document.createElement("td");
                tdGuest.textContent = staff.guestLocation;
                tdGuest.className = `loc-${staff.guestLocation.toLowerCase()}`;
                tr.appendChild(tdGuest);
                
                // Days of the week
                for (let i = 0; i < staff.schedule.length; i++) {
                    const tdDay = document.createElement("td");
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ "sick"
                    if (staff.schedule[i] === "sick") {
                        tdDay.textContent = "ü§í";
                    } else {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–∞ —Å–º–µ–Ω–∞ –≥–æ—Å—Ç–µ–≤–æ–π
                        let guestShiftLocation = null;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Å—Ç–µ–≤—ã–µ —Å–º–µ–Ω—ã
                        if (staff.shifts && Array.isArray(staff.shifts)) {
                            for (const shift of staff.shifts) {
                                if (shift.day === i) {
                                    guestShiftLocation = shift.location;
                                    break;
                                }
                            }
                        }
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –≥–æ—Å—Ç–µ–≤–∞—è —Å–º–µ–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞—Ü–∏—é –≤ —Å–∫–æ–±–∫–∞—Ö
                        if (guestShiftLocation && guestShiftLocation !== staff.homeLocation) {
                            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –ª–æ–∫–∞—Ü–∏–∏
                            tdDay.innerHTML = '';
                            const timeDiv = document.createElement('div');
                            timeDiv.textContent = staff.schedule[i];
                            
                            const locationDiv = document.createElement('div');
                            locationDiv.textContent = `(${guestShiftLocation})`;
                            locationDiv.style.fontSize = '0.8em';
                            locationDiv.style.color = '#666';
                            
                            tdDay.appendChild(timeDiv);
                            tdDay.appendChild(locationDiv);
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ü–≤–µ—Ç–∞ –ª–æ–∫–∞—Ü–∏–∏
                            tdDay.className = `loc-${guestShiftLocation.toLowerCase()}`;
                        } else {
                            tdDay.textContent = staff.schedule[i];
                            tdDay.className = getCellClass(staff.schedule[i]);
                        }
                    }
                    
                    tr.appendChild(tdDay);
                }
                
                tbody.appendChild(tr);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã–º–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö
        function populateStaffTable(tableId, staffData, headerInfo) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const tbody = table.querySelector("tbody");
            if (!tbody) return;
            
            for (const staff of staffData) {
                const tr = document.createElement("tr");
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è Senior Supervisor –∏–ª–∏ Senior Receptionist
                if (staffConfig.seniorSupervisors.includes(staff.name)) {
                    tr.className = "senior-supervisor";
                } else if (staffConfig.seniorReceptionists.includes(staff.name)) {
                    tr.className = "senior-receptionist";
                }
                
                // –Ø—á–µ–π–∫–∞ —Å –∏–º–µ–Ω–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                const nameTd = document.createElement("td");
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≥–æ—Å—Ç–µ–≤—ã–º –¥–ª—è —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏
                let isGuest = false;
                let guestLocation = "";
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é –ø–æ ID —Ç–∞–±–ª–∏—Ü—ã
                let currentLocation = "";
                if (tableId.startsWith("east")) {
                    currentLocation = "East";
                } else if (tableId.startsWith("rlh")) {
                    currentLocation = "RLH";
                } else if (tableId.startsWith("bankside")) {
                    currentLocation = "Bankside";
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ–º–∞—à–Ω—é—é –ª–æ–∫–∞—Ü–∏—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                const homeLocation = getStaffHomeLocation(staff.name);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≥–æ—Å—Ç–µ–≤—ã–º –¥–ª—è —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏
                if (homeLocation && homeLocation !== currentLocation && currentLocation !== "") {
                    isGuest = true;
                    guestLocation = homeLocation;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å
                if (tableId.includes("Admins")) {
                    nameTd.textContent = staff.name;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ª–∂–Ω–æ—Å—Ç—å –ø–æ–¥ –∏–º–µ–Ω–µ–º
                    const positionSpan = document.createElement("span");
                    positionSpan.className = "position-label";
                    
                    if (staffConfig.seniorSupervisors.includes(staff.name)) {
                        positionSpan.textContent = "Senior Reception Supervisor";
                    } else if (staffConfig.seniorReceptionists.includes(staff.name)) {
                        positionSpan.textContent = "Senior Receptionist";
                    } else {
                        positionSpan.textContent = "Receptionist";
                    }
                    
                    nameTd.appendChild(document.createElement("br"));
                    nameTd.appendChild(positionSpan);
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –°–ü–ê –≤ —Å–∫–æ–±–∫–∞—Ö –¥–ª—è –≥–æ—Å—Ç–µ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
                    if (isGuest) {
                        nameTd.textContent = `${staff.name} (${guestLocation})`;
                } else {
                    nameTd.textContent = staff.name;
                    }
                }
                
                tr.appendChild(nameTd);
                
                // –Ø—á–µ–π–∫–∏ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
                for (let i = 0; i < staff.schedule.length; i++) {
                    const scheduleTd = document.createElement("td");
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –∏ –∫–ª–∞—Å—Å —è—á–µ–π–∫–∏
                    const value = staff.schedule[i];
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ "sick"
                    if (value === "sick") {
                        scheduleTd.textContent = "ü§í";
                        scheduleTd.className = "cell-sick";
                    } else {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–º–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–≤–µ—Ç–∞ —è—á–µ–π–∫–∏
                        let shiftLocation = null;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≥–æ—Å—Ç–µ–≤—ã–µ —Å–º–µ–Ω—ã
                        if (staff.shifts && Array.isArray(staff.shifts)) {
                            for (const shift of staff.shifts) {
                                if (shift.day === i) {
                                    shiftLocation = shift.location;
                                    break;
                                }
                            }
                        }
                        
                        // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ª–æ–∫–∞—Ü–∏—é –≤ shifts, –ø—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ —Ü–≤–µ—Ç—É —è—á–µ–π–∫–∏
                        if (!shiftLocation && staff.row !== undefined && window.excelCellColors && headerInfo) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –ø—É—Å—Ç–æ–µ –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤—ã—Ö–æ–¥–Ω—ã–º –¥–Ω–µ–º
                            // –£—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ (—Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã)
                            if (value && value !== "X" && value !== "XR" && value !== "HOL" && value !== "TR" && 
                                value !== "sick" && value.trim() !== "") {
                                const col = headerInfo.dayColumns[i];
                                const colLetter = String.fromCharCode(65 + col);
                                const rowNumber = staff.row + 1;
                                const cellAddress = `${colLetter}${rowNumber}`;
                                
                                if (window.excelCellColors[cellAddress]) {
                                    const cellColor = window.excelCellColors[cellAddress].toLowerCase();
                                    
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ü–≤–µ—Ç –Ω–µ –±–µ–ª—ã–π –∏ –Ω–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π
                                    if (cellColor && cellColor !== "ffffff" && cellColor !== "transparent") {
                                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é –ø–æ —Ç–æ—á–Ω–æ–º—É —Ü–≤–µ—Ç—É
                                        if (cellColor === locationColors.East.toLowerCase()) {
                                            shiftLocation = "East";
                                        } else if (cellColor === locationColors.RLH.toLowerCase()) {
                                            shiftLocation = "RLH";
                                        } else if (cellColor === locationColors.Bankside.toLowerCase()) {
                                            shiftLocation = "Bankside";
                                        } 
                                        // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤
                                        else if (isSimilarColor(cellColor, locationColors.East)) {
                                            shiftLocation = "East";
                                        } else if (isSimilarColor(cellColor, locationColors.RLH)) {
                                            shiftLocation = "RLH";
                                        } else if (isSimilarColor(cellColor, locationColors.Bankside)) {
                                            shiftLocation = "Bankside";
                                        }
                                        
                                        // –í—ã–≤–æ–¥–∏–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                                        console.log(`–Ø—á–µ–π–∫–∞ ${cellAddress} –¥–ª—è ${staff.name}, –¥–µ–Ω—å ${i}: —Ü–≤–µ—Ç ${cellColor}, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ª–æ–∫–∞—Ü–∏—è ${shiftLocation}`);
                                    }
                                }
                            } else {
                                // –î–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–Ω–µ–π –∏ –±–æ–ª—å–Ω–∏—á–Ω—ã—Ö –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é
                                shiftLocation = null;
                            }
                        }
                        
                        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é
                        if (!shiftLocation) {
                            shiftLocation = currentLocation;
                        }
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –≥–æ—Å—Ç–µ–≤–∞—è —Å–º–µ–Ω–∞ (–ª–æ–∫–∞—Ü–∏—è —Å–º–µ–Ω—ã –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥–æ–º–∞—à–Ω–µ–π –ª–æ–∫–∞—Ü–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞)
                        // –ò —ç—Ç–æ –Ω–µ –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å –∏–ª–∏ –±–æ–ª—å–Ω–∏—á–Ω—ã–π
                        if (value && value !== "X" && value !== "XR" && value !== "HOL" && value !== "TR" && 
                            value !== "sick" && value.trim() !== "" && 
                            shiftLocation && homeLocation && shiftLocation !== homeLocation) {
                            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –ª–æ–∫–∞—Ü–∏–∏
                            scheduleTd.innerHTML = '';
                            const timeDiv = document.createElement('div');
                            timeDiv.textContent = value;
                            
                            const locationDiv = document.createElement('div');
                            locationDiv.textContent = `(${shiftLocation})`;
                            locationDiv.style.fontSize = '0.8em';
                            locationDiv.style.color = '#666';
                            
                            scheduleTd.appendChild(timeDiv);
                            scheduleTd.appendChild(locationDiv);
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ü–≤–µ—Ç–∞ –ª–æ–∫–∞—Ü–∏–∏
                            scheduleTd.className = `loc-${shiftLocation.toLowerCase()}`;
                        } else if (value && value !== "X" && value !== "XR" && value !== "HOL" && value !== "TR" && 
                                  value !== "sick" && value.trim() !== "") {
                            // –≠—Ç–æ –æ–±—ã—á–Ω–∞—è —Ä–∞–±–æ—á–∞—è —Å–º–µ–Ω–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã
                            scheduleTd.textContent = value;
                            scheduleTd.className = getCellClass(value);
                        } else {
                            // –≠—Ç–æ –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å –∏–ª–∏ –±–æ–ª—å–Ω–∏—á–Ω—ã–π
                            scheduleTd.textContent = value;
                            scheduleTd.className = getCellClass(value);
                        }
                    }
                    
                    tr.appendChild(scheduleTd);
                }
                
                tbody.appendChild(tr);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
        function clearAllTables() {
            const tables = [
                "eastAdmins", "eastAttendance", "eastTherapists",
                "rlhAdmins", "rlhAttendance", "rlhTherapists",
                "banksideAdmins", "banksideAttendance", "allGuestStaff",
                "staffHoursTable", "locationHoursTable", "positionHoursTable"
            ];
            
            for (const tableId of tables) {
                clearTableData(tableId);
            }
        }
        
        // Load demo data when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the page
            document.getElementById('statusMessage').className = 'status';
            document.getElementById('statusMessage').textContent = 'Upload an Excel file to display the schedule.';
        });
        
        // File change handler
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                console.log("File selected:", file.name);
                handleExcelFile(file);
            }
        });
        
        // Function to extract cell colors
        function extractCellColors(worksheet) {
            console.log("Extracting cell colors from Excel...");
            
            // Create object to store colors
            const cellColors = {};
            
            // Location colors for checking
            const locationColors = ["93c47d", "4a86e8", "b7b7b7", "ff0000"];
            
            // Go through all cells in the sheet
            for (const cellAddress in worksheet) {
                // Skip service properties
                if (cellAddress[0] === '!') continue;
                
                const cell = worksheet[cellAddress];
                
                // Check for styles
                if (cell.s) {
                    let cellColor = null;
                    
                    // Check different properties for color
                    if (cell.s.fill && cell.s.fill.fgColor && cell.s.fill.fgColor.rgb) {
                        cellColor = cell.s.fill.fgColor.rgb.toLowerCase();
                    } else if (cell.s.fgColor && cell.s.fgColor.rgb) {
                        cellColor = cell.s.fgColor.rgb.toLowerCase();
                    } else if (cell.s.bgColor && cell.s.bgColor.rgb) {
                        cellColor = cell.s.bgColor.rgb.toLowerCase();
                    }
                    
                    // If color found, save it
                    if (cellColor) {
                        cellColors[cellAddress] = cellColor;
                        
                        // Output only colors corresponding to locations or sick
                        if (locationColors.includes(cellColor)) {
                            console.log(`Cell ${cellAddress}: color ${cellColor}`);
                        }
                    }
                }
            }
            
            // Output statistics on found colors
            const colorStats = {};
            for (const cellAddress in cellColors) {
                const color = cellColors[cellAddress];
                colorStats[color] = (colorStats[color] || 0) + 1;
            }
            
            console.log("Color statistics:");
            for (const color in colorStats) {
                console.log(`${color}: ${colorStats[color]} cells`);
            }
            
            console.log(`Extracted ${Object.keys(cellColors).length} cell colors`);
            return cellColors;
        }
        
        // Function to calculate hours from a shift string
        function calculateHoursFromShift(shift) {
            if (!shift || typeof shift !== 'string') return 0;
            
            // Skip special statuses
            if (shift === "X" || shift === "XR" || shift === "HOL" || shift === "sick" || shift === "TR") {
                return 0;
            }
            
            console.log(`–†–∞—Å—á–µ—Ç —á–∞—Å–æ–≤ –¥–ª—è —Å–º–µ–Ω—ã: ${shift}`);
            
            // –ü–æ–ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏
            
            // –§–æ—Ä–º–∞—Ç "08.45-19.15" (—Å —Ç–æ—á–∫–æ–π)
            let match = shift.match(/(\d{1,2})\.(\d{2})-(\d{1,2})\.(\d{2})/);
            if (match) {
                let startHour = parseInt(match[1]);
                let startMinute = parseInt(match[2]);
                let endHour = parseInt(match[3]);
                let endMinute = parseInt(match[4]);
                
                console.log(`–§–æ—Ä–º–∞—Ç —Å —Ç–æ—á–∫–æ–π: ${startHour}:${startMinute} - ${endHour}:${endMinute}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ª–∏ —Å–º–µ–Ω–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
                if (endHour < startHour || (endHour === startHour && endMinute < startMinute)) {
                    endHour += 24; // –î–æ–±–∞–≤–ª—è–µ–º 24 —á–∞—Å–∞, –µ—Å–ª–∏ —Å–º–µ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
                }
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤
                let totalHours = (endHour - startHour) + (endMinute - startMinute) / 60;
                
                // –í—ã—á–∏—Ç–∞–µ–º 30 –º–∏–Ω—É—Ç (0.5 —á–∞—Å–∞) –∏–∑ –∫–∞–∂–¥–æ–π —Ä–∞–±–æ—á–µ–π —Å–º–µ–Ω—ã
                totalHours = Math.max(0, totalHours - 0.5);
                
                console.log(`–†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —á–∞—Å—ã (–ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ 30 –º–∏–Ω—É—Ç): ${totalHours}`);
                
                return Math.round(totalHours * 10) / 10; // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 1 –¥–µ—Å—è—Ç–∏—á–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
            }
            
            // –§–æ—Ä–º–∞—Ç "08:45-19:15" (—Å –¥–≤–æ–µ—Ç–æ—á–∏–µ–º)
            match = shift.match(/(\d{1,2}):(\d{2})-(\d{1,2}):(\d{2})/);
            if (match) {
                let startHour = parseInt(match[1]);
                let startMinute = parseInt(match[2]);
                let endHour = parseInt(match[3]);
                let endMinute = parseInt(match[4]);
                
                console.log(`–§–æ—Ä–º–∞—Ç —Å –¥–≤–æ–µ—Ç–æ—á–∏–µ–º: ${startHour}:${startMinute} - ${endHour}:${endMinute}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ª–∏ —Å–º–µ–Ω–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
                if (endHour < startHour || (endHour === startHour && endMinute < startMinute)) {
                    endHour += 24; // –î–æ–±–∞–≤–ª—è–µ–º 24 —á–∞—Å–∞, –µ—Å–ª–∏ —Å–º–µ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
                }
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤
                let totalHours = (endHour - startHour) + (endMinute - startMinute) / 60;
                
                // –í—ã—á–∏—Ç–∞–µ–º 30 –º–∏–Ω—É—Ç (0.5 —á–∞—Å–∞) –∏–∑ –∫–∞–∂–¥–æ–π —Ä–∞–±–æ—á–µ–π —Å–º–µ–Ω—ã
                totalHours = Math.max(0, totalHours - 0.5);
                
                console.log(`–†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —á–∞—Å—ã (–ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ 30 –º–∏–Ω—É—Ç): ${totalHours}`);
                
                return Math.round(totalHours * 10) / 10; // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 1 –¥–µ—Å—è—Ç–∏—á–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
            }
            
            // –§–æ—Ä–º–∞—Ç "9-5" (—Ç–æ–ª—å–∫–æ —á–∞—Å—ã)
            match = shift.match(/^(\d{1,2})-(\d{1,2})$/);
            if (match) {
                let startHour = parseInt(match[1]);
                let endHour = parseInt(match[2]);
                
                console.log(`–§–æ—Ä–º–∞—Ç —Ç–æ–ª—å–∫–æ —á–∞—Å—ã: ${startHour} - ${endHour}`);
                
                // –ï—Å–ª–∏ –∫–æ–Ω–µ—á–Ω—ã–π —á–∞—Å –º–µ–Ω—å—à–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —ç—Ç–æ PM –≤—Ä–µ–º—è
                if (endHour < startHour) {
                    endHour += 12; // –î–æ–±–∞–≤–ª—è–µ–º 12 —á–∞—Å–æ–≤ –¥–ª—è PM –≤—Ä–µ–º–µ–Ω–∏
                }
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤
                let totalHours = endHour - startHour;
                
                // –í—ã—á–∏—Ç–∞–µ–º 30 –º–∏–Ω—É—Ç (0.5 —á–∞—Å–∞) –∏–∑ –∫–∞–∂–¥–æ–π —Ä–∞–±–æ—á–µ–π —Å–º–µ–Ω—ã
                totalHours = Math.max(0, totalHours - 0.5);
                
                console.log(`–†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —á–∞—Å—ã (–ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ 30 –º–∏–Ω—É—Ç): ${totalHours}`);
                
                return totalHours;
            }
            
            // –§–æ—Ä–º–∞—Ç "9" (—Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª—å–Ω—ã–π —á–∞—Å, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º 8-—á–∞—Å–æ–≤—É—é —Å–º–µ–Ω—É)
            match = shift.match(/^(\d{1,2})$/);
            if (match) {
                let startHour = parseInt(match[1]);
                let endHour = startHour + 8; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º 8-—á–∞—Å–æ–≤—É—é —Å–º–µ–Ω—É
                
                console.log(`–§–æ—Ä–º–∞—Ç —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª—å–Ω—ã–π —á–∞—Å: ${startHour}, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º 8-—á–∞—Å–æ–≤—É—é —Å–º–µ–Ω—É –¥–æ ${endHour}`);
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤
                let totalHours = 8;
                
                // –í—ã—á–∏—Ç–∞–µ–º 30 –º–∏–Ω—É—Ç (0.5 —á–∞—Å–∞) –∏–∑ –∫–∞–∂–¥–æ–π —Ä–∞–±–æ—á–µ–π —Å–º–µ–Ω—ã
                totalHours = Math.max(0, totalHours - 0.5);
                
                console.log(`–†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —á–∞—Å—ã (–ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ 30 –º–∏–Ω—É—Ç): ${totalHours}`);
                
                return totalHours;
            }
            
            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é 8-—á–∞—Å–æ–≤—É—é —Å–º–µ–Ω—É
            console.log(`–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å–º–µ–Ω—ã: ${shift}, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ 8 —á–∞—Å–æ–≤ (–ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ 30 –º–∏–Ω—É—Ç: 7.5)`);
            return 7.5; // 8 —á–∞—Å–æ–≤ –º–∏–Ω—É—Å 30 –º–∏–Ω—É—Ç (0.5 —á–∞—Å–∞)
        }
        
        // Function to get cell color for a staff member on a specific day
        function getCellColorForStaff(staffName, dayIndex, homeLocation) {
            if (!window.lastLoadedData) return null;
            
            const data = window.lastLoadedData;
            const headerInfo = findHeaderInfo(data);
            
            if (!headerInfo || !headerInfo.dayColumns || headerInfo.dayColumns.length === 0) {
                return null;
            }
            
            const col = headerInfo.dayColumns[dayIndex];
            
            // Find staff row
            for (let i = 0; i < data.length; i++) {
                if (!data[i] || !data[i][0] || typeof data[i][0] !== 'string') continue;
                
                const rowStaffName = data[i][0].trim();
                
                if (rowStaffName.includes(staffName) || staffName.includes(rowStaffName)) {
                    // Check cell color
                    if (data[i]._cells && data[i]._cells[col] && data[i]._cells[col].s) {
                        let cellColor = null;
                        
                        // Check different properties for color
                        if (data[i]._cells[col].s.bgColor && data[i]._cells[col].s.bgColor.rgb) {
                            cellColor = data[i]._cells[col].s.bgColor.rgb.toLowerCase();
                            console.log(`Found bgColor: ${cellColor}`);
                        }
                        else if (data[i]._cells[col].s.fgColor && data[i]._cells[col].s.fgColor.rgb) {
                            cellColor = data[i]._cells[col].s.fgColor.rgb.toLowerCase();
                            console.log(`Found fgColor: ${cellColor}`);
                        }
                        else if (data[i]._cells[col].s.fill && data[i]._cells[col].s.fill.fgColor && data[i]._cells[col].s.fill.fgColor.rgb) {
                            cellColor = data[i]._cells[col].s.fill.fgColor.rgb.toLowerCase();
                            console.log(`Found fill.fgColor: ${cellColor}`);
                        }
                        
                        if (cellColor) {
                            // Check which location this color corresponds to
                            if (isSimilarColor(cellColor, locationColors.East)) {
                                return "East";
                            } else if (isSimilarColor(cellColor, locationColors.RLH)) {
                                return "RLH";
                            } else if (isSimilarColor(cellColor, locationColors.Bankside)) {
                                return "Bankside";
                            }
                        }
                    }
                    
                    return homeLocation; // Default to home location if no color found
                }
            }
            
            return null;
        }
        
        // Function to populate staff hours table
        function populateStaffHoursTable(staffList) {
            const table = document.getElementById('staffHoursTable');
            if (!table) return;
            
            const tbody = table.querySelector('tbody');
            if (!tbody) return;
            
            // Clear the table
            tbody.innerHTML = '';
            
            // Sort staff by total hours (descending)
            staffList.sort((a, b) => b.totalHours - a.totalHours);
            
            // Add each staff member to the table
            for (const staff of staffList) {
                // Skip staff with 0 hours
                if (staff.totalHours === 0) continue;
                
                const tr = document.createElement('tr');
                
                // Staff name
                const tdName = document.createElement('td');
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏–∏, –≥–¥–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –≥–æ—Å—Ç—å
                let guestLocations = [];
                if (staff.homeLocation !== "East" && staff.eastHours > 0) {
                    guestLocations.push("East");
                }
                if (staff.homeLocation !== "RLH" && staff.rlhHours > 0) {
                    guestLocations.push("RLH");
                }
                if (staff.homeLocation !== "Bankside" && staff.banksideHours > 0) {
                    guestLocations.push("Bankside");
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –°–ü–ê –≤ —Å–∫–æ–±–∫–∞—Ö –¥–ª—è –≥–æ—Å—Ç–µ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
                if (guestLocations.length > 0) {
                    tdName.textContent = `${staff.name} (${guestLocations.join(", ")})`;
                } else {
                    tdName.textContent = staff.name;
                }
                
                tdName.style.fontWeight = 'bold';
                tr.appendChild(tdName);
                
                // Staff position
                const tdPosition = document.createElement('td');
                tdPosition.textContent = staff.position || 'N/A';
                tr.appendChild(tdPosition);
                
                // Staff home location
                const tdLocation = document.createElement('td');
                tdLocation.textContent = staff.homeLocation || 'N/A';
                
                // Apply location color
                if (staff.homeLocation) {
                    tdLocation.className = `loc-${staff.homeLocation.toLowerCase()}`;
                }
                
                tr.appendChild(tdLocation);
                
                // Total hours
                const tdTotalHours = document.createElement('td');
                tdTotalHours.textContent = staff.totalHours.toFixed(1);
                tdTotalHours.style.textAlign = 'right';
                tdTotalHours.style.fontWeight = 'bold';
                tr.appendChild(tdTotalHours);
                
                // Home hours
                const tdHomeHours = document.createElement('td');
                tdHomeHours.textContent = staff.homeHours.toFixed(1);
                tdHomeHours.style.textAlign = 'right';
                tr.appendChild(tdHomeHours);
                
                // Guest hours
                const tdGuestHours = document.createElement('td');
                tdGuestHours.textContent = staff.guestHours.toFixed(1);
                tdGuestHours.style.textAlign = 'right';
                tr.appendChild(tdGuestHours);
                
                // East hours
                const tdEastHours = document.createElement('td');
                tdEastHours.textContent = staff.eastHours.toFixed(1);
                tdEastHours.style.textAlign = 'right';
                if (staff.eastHours > 0) {
                    tdEastHours.className = 'loc-east';
                }
                tr.appendChild(tdEastHours);
                
                // RLH hours
                const tdRlhHours = document.createElement('td');
                tdRlhHours.textContent = staff.rlhHours.toFixed(1);
                tdRlhHours.style.textAlign = 'right';
                if (staff.rlhHours > 0) {
                    tdRlhHours.className = 'loc-rlh';
                }
                tr.appendChild(tdRlhHours);
                
                // Bankside hours
                const tdBanksideHours = document.createElement('td');
                tdBanksideHours.textContent = staff.banksideHours.toFixed(1);
                tdBanksideHours.style.textAlign = 'right';
                if (staff.banksideHours > 0) {
                    tdBanksideHours.className = 'loc-bankside';
                }
                tr.appendChild(tdBanksideHours);
                
                tbody.appendChild(tr);
            }
            
            // If no data, show message
            if (tbody.children.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.textContent = 'No data available';
                td.colSpan = 9;
                td.style.textAlign = 'center';
                td.style.fontStyle = 'italic';
                td.style.padding = '20px';
                tr.appendChild(td);
                tbody.appendChild(tr);
            }
        }
        
        // Function to calculate hours by position
        function calculatePositionHours(staffList) {
            const positionTotals = {};
            
            staffList.forEach(staff => {
                const totalHours = calculateTotalHoursForStaff(staff);
                const position = staff.position || 'Unknown';
                
                // Add hours to appropriate position
                positionTotals[position] = (positionTotals[position] || 0) + totalHours;
            });
            
            return positionTotals;
        }
        
        // Function to populate position hours table
        function populatePositionHoursTable(positionTotals) {
            const table = document.getElementById('positionHoursTable');
            if (!table) return;
            
            const tbody = table.querySelector('tbody');
            if (!tbody) return;
            
            // Clear the table
            tbody.innerHTML = '';
            
            // Get positions sorted by total hours (descending)
            const sortedPositions = Object.keys(positionTotals).sort((a, b) => 
                positionTotals[b].total - positionTotals[a].total
            );
            
            // Add each position to the table
            for (const position of sortedPositions) {
                const hours = positionTotals[position];
                
                // Skip positions with 0 hours
                if (hours.total === 0) continue;
                
                const tr = document.createElement('tr');
                
                // Position name
                const tdPosition = document.createElement('td');
                tdPosition.textContent = position;
                tdPosition.style.fontWeight = 'bold';
                tr.appendChild(tdPosition);
                
                // Total hours
                const tdTotal = document.createElement('td');
                tdTotal.textContent = hours.total.toFixed(1);
                tdTotal.style.textAlign = 'right';
                tdTotal.style.fontWeight = 'bold';
                tr.appendChild(tdTotal);
                
                // East hours
                const tdEast = document.createElement('td');
                tdEast.textContent = hours.east.toFixed(1);
                tdEast.style.textAlign = 'right';
                if (hours.east > 0) {
                    tdEast.className = 'loc-east';
                }
                tr.appendChild(tdEast);
                
                // RLH hours
                const tdRlh = document.createElement('td');
                tdRlh.textContent = hours.rlh.toFixed(1);
                tdRlh.style.textAlign = 'right';
                if (hours.rlh > 0) {
                    tdRlh.className = 'loc-rlh';
                }
                tr.appendChild(tdRlh);
                
                // Bankside hours
                const tdBankside = document.createElement('td');
                tdBankside.textContent = hours.bankside.toFixed(1);
                tdBankside.style.textAlign = 'right';
                if (hours.bankside > 0) {
                    tdBankside.className = 'loc-bankside';
                }
                tr.appendChild(tdBankside);
                
                tbody.appendChild(tr);
            }
            
            // If no data, show message
            if (tbody.children.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.textContent = 'No data available';
                td.colSpan = 5;
                td.style.textAlign = 'center';
                td.style.fontStyle = 'italic';
                td.style.padding = '20px';
                tr.appendChild(td);
                tbody.appendChild(tr);
            }
        }
        
        // Function to calculate and display analytics
        function calculateAndDisplayAnalytics(allStaffByCategory, guestStaff, headerInfo) {
            console.log("Calculating analytics...");
            
            // –°–æ–∑–¥–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            let debugInfo = "<h3>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ</h3>";
            
            // Combine all staff into one list
            let allStaff = [];
            
            // Add regular staff from all categories
            for (const category in allStaffByCategory) {
                if (allStaffByCategory[category] && Array.isArray(allStaffByCategory[category])) {
                    debugInfo += `<p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${category}, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${allStaffByCategory[category].length}</p>`;
                    
                    for (const staff of allStaffByCategory[category]) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ–º–∞—à–Ω–µ–π –ª–æ–∫–∞—Ü–∏–∏ –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
                        const homeLocation = getStaffHomeLocation(staff.name);
                        const position = getStaffPosition(staff.name);
                        
                        debugInfo += `<p>–°–æ—Ç—Ä—É–¥–Ω–∏–∫: ${staff.name}, –¥–æ–º–∞—à–Ω—è—è –ª–æ–∫–∞—Ü–∏—è: ${homeLocation}, –¥–æ–ª–∂–Ω–æ—Å—Ç—å: ${position}</p>`;
                        
                        allStaff.push({
                            name: staff.name,
                            homeLocation: homeLocation,
                            position: position,
                            schedule: staff.schedule,
                            originalRow: staff.originalRow // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                        });
                    }
                }
            }
            
            // Add guest staff
            if (guestStaff && guestStaff.length > 0) {
                debugInfo += `<p>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${guestStaff.length}</p>`;
                allStaff = allStaff.concat(guestStaff);
            }
            
            console.log(`Total staff for analytics: ${allStaff.length}`);
            debugInfo += `<p>–í—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: ${allStaff.length}</p>`;
            
            // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (–ø–æ –∏–º–µ–Ω–∏)
            const uniqueStaff = [];
            const staffNames = new Set();
            
            for (const staff of allStaff) {
                if (!staffNames.has(staff.name)) {
                    staffNames.add(staff.name);
                    uniqueStaff.push(staff);
                }
            }
            
            console.log(`Unique staff for analytics: ${uniqueStaff.length}`);
            debugInfo += `<p>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: ${uniqueStaff.length}</p>`;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —á–∞—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            for (const staff of uniqueStaff) {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫–∏ —á–∞—Å–æ–≤
                staff.totalHours = 0;
                staff.homeHours = 0;
                staff.guestHours = 0;
                staff.eastHours = 0;
                staff.rlhHours = 0;
                staff.banksideHours = 0;
                
                debugInfo += `<h4>–†–∞—Å—á–µ—Ç —á–∞—Å–æ–≤ –¥–ª—è ${staff.name}</h4>`;
                debugInfo += `<ul>`;
                
                // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏ —Å—á–∏—Ç–∞–µ–º —á–∞—Å—ã
                if (staff.schedule && Array.isArray(staff.schedule)) {
                for (let i = 0; i < staff.schedule.length; i++) {
                        const shift = staff.schedule[i];
                        
                        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—ã—Ö–æ–¥–Ω—ã–µ –∏ –±–æ–ª—å–Ω–∏—á–Ω—ã–µ
                        if (!shift || shift === "X" || shift === "XR" || shift === "HOL" || shift === "TR" || shift === "sick") {
                            continue;
                        }
                        
                        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —á–∞—Å—ã –¥–ª—è —Å–º–µ–Ω—ã
                        const hours = calculateHoursFromShift(shift);
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é –¥–ª—è —Å–º–µ–Ω—ã
                        let shiftLocation = null;
                        
                        // –ü–æ–ª—É—á–∞–µ–º —Ü–≤–µ—Ç —è—á–µ–π–∫–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏
                        const cellColor = getCellColorForDay(staff.name, i, headerInfo);
                        
                        if (cellColor) {
                            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é –ø–æ —Ü–≤–µ—Ç—É —è—á–µ–π–∫–∏
                            if (isSimilarColor(cellColor, locationColors.East)) {
                                shiftLocation = "East";
                            } else if (isSimilarColor(cellColor, locationColors.RLH)) {
                                shiftLocation = "RLH";
                            } else if (isSimilarColor(cellColor, locationColors.Bankside)) {
                                shiftLocation = "Bankside";
                            }
                        }
                        
                        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é –ø–æ —Ü–≤–µ—Ç—É, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Å—Ç–µ–≤—ã–µ —Å–º–µ–Ω—ã
                        if (!shiftLocation && staff.shifts && Array.isArray(staff.shifts)) {
                            for (const guestShift of staff.shifts) {
                                if (guestShift.day === i) {
                                    shiftLocation = guestShift.location;
                                    break;
                                }
                            }
                        }
                        
                        // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–æ–º–∞—à–Ω—é—é
                        if (!shiftLocation) {
                            shiftLocation = staff.homeLocation;
                        }
                        
                        debugInfo += `<li>–î–µ–Ω—å ${i+1}, —Å–º–µ–Ω–∞: ${shift}, —á–∞—Å—ã: ${hours}, –ª–æ–∫–∞—Ü–∏—è: ${shiftLocation || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</li>`;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —á–∞—Å—ã –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Å—á–µ—Ç—á–∏–∫–∞–º
                        staff.totalHours += hours;
                        
                        if (shiftLocation === staff.homeLocation) {
                            staff.homeHours += hours;
                        } else if (shiftLocation) {
                            staff.guestHours += hours;
                        } else {
                            // –ï—Å–ª–∏ –ª–æ–∫–∞—Ü–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞, —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ –¥–æ–º–∞—à–Ω—é—é
                            staff.homeHours += hours;
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —á–∞—Å—ã –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –ª–æ–∫–∞—Ü–∏–∏
                        if (shiftLocation === "East") {
                            staff.eastHours += hours;
                        } else if (shiftLocation === "RLH") {
                            staff.rlhHours += hours;
                        } else if (shiftLocation === "Bankside") {
                            staff.banksideHours += hours;
                        } else if (staff.homeLocation === "East") {
                            // –ï—Å–ª–∏ –ª–æ–∫–∞—Ü–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–æ–º–∞—à–Ω—é—é
                            staff.eastHours += hours;
                        } else if (staff.homeLocation === "RLH") {
                            staff.rlhHours += hours;
                        } else if (staff.homeLocation === "Bankside") {
                            staff.banksideHours += hours;
                        }
                    }
                }
                
                debugInfo += `</ul>`;
                debugInfo += `<p>–ò—Ç–æ–≥–æ –¥–ª—è ${staff.name}: –≤—Å–µ–≥–æ —á–∞—Å–æ–≤: ${staff.totalHours.toFixed(1)}, –¥–æ–º–∞—à–Ω–∏–µ: ${staff.homeHours.toFixed(1)}, –≥–æ—Å—Ç–µ–≤—ã–µ: ${staff.guestHours.toFixed(1)}, East: ${staff.eastHours.toFixed(1)}, RLH: ${staff.rlhHours.toFixed(1)}, Bankside: ${staff.banksideHours.toFixed(1)}</p>`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                if (staff.totalHours < 0 || staff.homeHours < 0 || staff.guestHours < 0 || 
                    staff.eastHours < 0 || staff.rlhHours < 0 || staff.banksideHours < 0) {
                    debugInfo += `<p style="color: red; font-weight: bold">–í–ù–ò–ú–ê–ù–ò–ï! –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è ${staff.name}!</p>`;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É–º–º
                if (Math.abs(staff.totalHours - (staff.homeHours + staff.guestHours)) > 0.1) {
                    debugInfo += `<p style="color: red; font-weight: bold">–í–ù–ò–ú–ê–ù–ò–ï! –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É–º–º –¥–ª—è ${staff.name}: totalHours (${staff.totalHours.toFixed(1)}) ‚â† homeHours (${staff.homeHours.toFixed(1)}) + guestHours (${staff.guestHours.toFixed(1)}) = ${(staff.homeHours + staff.guestHours).toFixed(1)}</p>`;
                }
                
                if (Math.abs(staff.totalHours - (staff.eastHours + staff.rlhHours + staff.banksideHours)) > 0.1) {
                    debugInfo += `<p style="color: red; font-weight: bold">–í–ù–ò–ú–ê–ù–ò–ï! –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É–º–º –¥–ª—è ${staff.name}: totalHours (${staff.totalHours.toFixed(1)}) ‚â† eastHours (${staff.eastHours.toFixed(1)}) + rlhHours (${staff.rlhHours.toFixed(1)}) + banksideHours (${staff.banksideHours.toFixed(1)}) = ${(staff.eastHours + staff.rlhHours + staff.banksideHours).toFixed(1)}</p>`;
                }
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å —á–∞—Å–∞–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            populateStaffHoursTable(uniqueStaff);
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —á–∞—Å—ã –ø–æ –ª–æ–∫–∞—Ü–∏—è–º
            const locationHours = {
                "East": { total: 0, home: 0, guest: 0 },
                "RLH": { total: 0, home: 0, guest: 0 },
                "Bankside": { total: 0, home: 0, guest: 0 }
            };
            
            for (const staff of uniqueStaff) {
                // East —á–∞—Å—ã
                locationHours.East.total += staff.eastHours;
                if (staff.homeLocation === "East") {
                    locationHours.East.home += staff.eastHours;
                } else {
                    locationHours.East.guest += staff.eastHours;
                }
                
                // RLH —á–∞—Å—ã
                locationHours.RLH.total += staff.rlhHours;
                if (staff.homeLocation === "RLH") {
                    locationHours.RLH.home += staff.rlhHours;
                } else {
                    locationHours.RLH.guest += staff.rlhHours;
                }
                
                // Bankside —á–∞—Å—ã
                locationHours.Bankside.total += staff.banksideHours;
                if (staff.homeLocation === "Bankside") {
                    locationHours.Bankside.home += staff.banksideHours;
                } else {
                    locationHours.Bankside.guest += staff.banksideHours;
                }
            }
            
            debugInfo += `<h4>–ò—Ç–æ–≥–æ–≤—ã–µ —á–∞—Å—ã –ø–æ –ª–æ–∫–∞—Ü–∏—è–º:</h4>`;
            for (const location in locationHours) {
                debugInfo += `<p>${location}: –≤—Å–µ–≥–æ: ${locationHours[location].total.toFixed(1)}, –¥–æ–º–∞—à–Ω–∏–µ: ${locationHours[location].home.toFixed(1)}, –≥–æ—Å—Ç–µ–≤—ã–µ: ${locationHours[location].guest.toFixed(1)}</p>`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                if (locationHours[location].total < 0 || locationHours[location].home < 0 || locationHours[location].guest < 0) {
                    debugInfo += `<p style="color: red; font-weight: bold">–í–ù–ò–ú–ê–ù–ò–ï! –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ª–æ–∫–∞—Ü–∏–∏ ${location}!</p>`;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É–º–º
                if (Math.abs(locationHours[location].total - (locationHours[location].home + locationHours[location].guest)) > 0.1) {
                    debugInfo += `<p style="color: red; font-weight: bold">–í–ù–ò–ú–ê–ù–ò–ï! –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É–º–º –¥–ª—è –ª–æ–∫–∞—Ü–∏–∏ ${location}: total (${locationHours[location].total.toFixed(1)}) ‚â† home (${locationHours[location].home.toFixed(1)}) + guest (${locationHours[location].guest.toFixed(1)}) = ${(locationHours[location].home + locationHours[location].guest).toFixed(1)}</p>`;
                }
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å —á–∞—Å–∞–º–∏ –ø–æ –ª–æ–∫–∞—Ü–∏—è–º
            populateLocationHoursTable(locationHours);
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —á–∞—Å—ã –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º
            const positionHours = {};
            
            for (const staff of uniqueStaff) {
                const position = staff.position || "Unknown";
                
                if (!positionHours[position]) {
                    positionHours[position] = {
                        total: 0,
                        east: 0,
                        rlh: 0,
                        bankside: 0
                    };
                }
                
                positionHours[position].total += staff.totalHours;
                positionHours[position].east += staff.eastHours;
                positionHours[position].rlh += staff.rlhHours;
                positionHours[position].bankside += staff.banksideHours;
            }
            
            debugInfo += `<h4>–ò—Ç–æ–≥–æ–≤—ã–µ —á–∞—Å—ã –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º:</h4>`;
            for (const position in positionHours) {
                debugInfo += `<p>${position}: –≤—Å–µ–≥–æ: ${positionHours[position].total.toFixed(1)}, East: ${positionHours[position].east.toFixed(1)}, RLH: ${positionHours[position].rlh.toFixed(1)}, Bankside: ${positionHours[position].bankside.toFixed(1)}</p>`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                if (positionHours[position].total < 0 || positionHours[position].east < 0 || 
                    positionHours[position].rlh < 0 || positionHours[position].bankside < 0) {
                    debugInfo += `<p style="color: red; font-weight: bold">–í–ù–ò–ú–ê–ù–ò–ï! –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ ${position}!</p>`;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É–º–º
                if (Math.abs(positionHours[position].total - (positionHours[position].east + positionHours[position].rlh + positionHours[position].bankside)) > 0.1) {
                    debugInfo += `<p style="color: red; font-weight: bold">–í–ù–ò–ú–ê–ù–ò–ï! –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É–º–º –¥–ª—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ ${position}: total (${positionHours[position].total.toFixed(1)}) ‚â† east (${positionHours[position].east.toFixed(1)}) + rlh (${positionHours[position].rlh.toFixed(1)}) + bankside (${positionHours[position].bankside.toFixed(1)}) = ${(positionHours[position].east + positionHours[position].rlh + positionHours[position].bankside).toFixed(1)}</p>`;
                }
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å —á–∞—Å–∞–º–∏ –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º
            populatePositionHoursTable(positionHours);
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            const debugElement = document.createElement('div');
            debugElement.id = 'analyticsDebugInfo';
            debugElement.style.display = 'none';
            debugElement.style.padding = '20px';
            debugElement.style.backgroundColor = '#f9f9f9';
            debugElement.style.border = '1px solid #ddd';
            debugElement.style.margin = '20px 0';
            debugElement.style.maxHeight = '500px';
            debugElement.style.overflow = 'auto';
            debugElement.innerHTML = debugInfo;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            const debugButton = document.createElement('button');
            debugButton.textContent = 'Show Analytics Debug Info';
            debugButton.style.marginTop = '10px';
            debugButton.style.padding = '5px 10px';
            debugButton.style.backgroundColor = '#f0f0f0';
            debugButton.style.border = '1px solid #ddd';
            debugButton.style.borderRadius = '4px';
            debugButton.style.cursor = 'pointer';
            
            debugButton.onclick = function() {
                const debugElement = document.getElementById('analyticsDebugInfo');
                if (debugElement.style.display === 'none') {
                    debugElement.style.display = 'block';
                    this.textContent = 'Hide Analytics Debug Info';
                } else {
                    debugElement.style.display = 'none';
                    this.textContent = 'Show Analytics Debug Info';
                }
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const analyticsTab = document.getElementById('analytics-tab');
            analyticsTab.appendChild(debugButton);
            analyticsTab.appendChild(debugElement);
        }
        
        // Function to populate location hours table
        function populateLocationHoursTable(locationHours) {
            const table = document.getElementById('locationHoursTable');
            if (!table) return;
            
            const tbody = table.querySelector('tbody');
            if (!tbody) return;
            
            // Clear the table
            tbody.innerHTML = '';
            
            // Get locations sorted by total hours (descending)
            const sortedLocations = Object.keys(locationHours).sort((a, b) => 
                locationHours[b].total - locationHours[a].total
            );
            
            // Add each location to the table
            for (const location of sortedLocations) {
                const hours = locationHours[location];
                
                // Skip locations with 0 hours
                if (hours.total === 0) continue;
                
                const tr = document.createElement('tr');
                
                // Location name
                const tdLocation = document.createElement('td');
                tdLocation.textContent = location;
                tdLocation.className = `loc-${location.toLowerCase()}`;
                tr.appendChild(tdLocation);
                
                // Total hours
                const tdTotal = document.createElement('td');
                tdTotal.textContent = hours.total.toFixed(1);
                tdTotal.style.textAlign = 'right';
                tdTotal.style.fontWeight = 'bold';
                tr.appendChild(tdTotal);
                
                // Home staff hours
                const tdHome = document.createElement('td');
                tdHome.textContent = hours.home.toFixed(1);
                tdHome.style.textAlign = 'right';
                tr.appendChild(tdHome);
                
                // Guest staff hours
                const tdGuest = document.createElement('td');
                tdGuest.textContent = hours.guest.toFixed(1);
                tdGuest.style.textAlign = 'right';
                tr.appendChild(tdGuest);
                
                tbody.appendChild(tr);
            }
            
            // If no data, show message
            if (tbody.children.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.textContent = 'No data available';
                td.colSpan = 4;
                td.style.textAlign = 'center';
                td.style.fontStyle = 'italic';
                td.style.padding = '20px';
                tr.appendChild(td);
                tbody.appendChild(tr);
            }
        }
        
        // Function to populate position hours table
        function populatePositionHoursTable(positionHours) {
            const table = document.getElementById('positionHoursTable');
            if (!table) return;
            
            const tbody = table.querySelector('tbody');
            if (!tbody) return;
            
            // Clear the table
            tbody.innerHTML = '';
            
            // Get positions sorted by total hours (descending)
            const sortedPositions = Object.keys(positionHours).sort((a, b) => 
                positionHours[b].total - positionHours[a].total
            );
            
            // Add each position to the table
            for (const position of sortedPositions) {
                const hours = positionHours[position];
                
                // Skip positions with 0 hours
                if (hours.total === 0) continue;
                
                const tr = document.createElement('tr');
                
                // Position name
                const tdPosition = document.createElement('td');
                tdPosition.textContent = position;
                tdPosition.style.fontWeight = 'bold';
                tr.appendChild(tdPosition);
                
                // Total hours
                const tdTotal = document.createElement('td');
                tdTotal.textContent = hours.total.toFixed(1);
                tdTotal.style.textAlign = 'right';
                tdTotal.style.fontWeight = 'bold';
                tr.appendChild(tdTotal);
                
                // East hours
                const tdEast = document.createElement('td');
                tdEast.textContent = hours.east.toFixed(1);
                tdEast.style.textAlign = 'right';
                if (hours.east > 0) {
                    tdEast.className = 'loc-east';
                }
                tr.appendChild(tdEast);
                
                // RLH hours
                const tdRlh = document.createElement('td');
                tdRlh.textContent = hours.rlh.toFixed(1);
                tdRlh.style.textAlign = 'right';
                if (hours.rlh > 0) {
                    tdRlh.className = 'loc-rlh';
                }
                tr.appendChild(tdRlh);
                
                // Bankside hours
                const tdBankside = document.createElement('td');
                tdBankside.textContent = hours.bankside.toFixed(1);
                tdBankside.style.textAlign = 'right';
                if (hours.bankside > 0) {
                    tdBankside.className = 'loc-bankside';
                }
                tr.appendChild(tdBankside);
                
                tbody.appendChild(tr);
            }
            
            // If no data, show message
            if (tbody.children.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.textContent = 'No data available';
                td.colSpan = 5;
                td.style.textAlign = 'center';
                td.style.fontStyle = 'italic';
                td.style.padding = '20px';
                tr.appendChild(td);
                tbody.appendChild(tr);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤
        function isSimilarColor(color1, color2) {
            if (!color1 || !color2) return false;
            
            // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            if (color1.toLowerCase() === color2.toLowerCase()) return true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            try {
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ü–≤–µ—Ç–∞ –≤ RGB –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
                const rgb1 = {
                    r: parseInt(color1.substring(0, 2), 16),
                    g: parseInt(color1.substring(2, 4), 16),
                    b: parseInt(color1.substring(4, 6), 16)
                };
                
                const rgb2 = {
                    r: parseInt(color2.substring(0, 2), 16),
                    g: parseInt(color2.substring(2, 4), 16),
                    b: parseInt(color2.substring(4, 6), 16)
                };
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
                const diff = {
                    r: Math.abs(rgb1.r - rgb2.r),
                    g: Math.abs(rgb1.g - rgb2.g),
                    b: Math.abs(rgb1.b - rgb2.b)
                };
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—á–µ–Ω—å —Å—Ç—Ä–æ–≥–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤
                // –î–ª—è —Ç–æ—á–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ #93C47D, #4A86E8, #B7B7B7
                const threshold = 3;
                return diff.r <= threshold && diff.g <= threshold && diff.b <= threshold;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Ü–≤–µ—Ç–æ–≤:", e);
                return false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ —è—á–µ–π–∫–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –¥–Ω—è
        function getCellColorForDay(staffName, dayIndex, headerInfo) {
            if (!window.lastLoadedData || !window.excelCellColors) return null;
            
            const data = window.lastLoadedData;
            
            // –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º
            let staffRow = -1;
            for (let i = 0; i < data.length; i++) {
                if (!data[i] || !data[i][0] || typeof data[i][0] !== 'string') continue;
                
                const rowStaffName = data[i][0].trim();
                if (rowStaffName === staffName || rowStaffName.includes(staffName) || staffName.includes(rowStaffName)) {
                    staffRow = i;
                    break;
                }
            }
            
            if (staffRow === -1) return null;
            
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–æ–Ω–∫—É –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ –¥–Ω—è
            const dayColumn = headerInfo.dayColumns[dayIndex];
            if (!dayColumn) return null;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –∞–¥—Ä–µ—Å —è—á–µ–π–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Excel (–Ω–∞–ø—Ä–∏–º–µ—Ä, A1, B2)
            const colLetter = String.fromCharCode(65 + dayColumn); // A, B, C, ...
            const rowNumber = staffRow + 1; // Excel –Ω–∞—á–∏–Ω–∞–µ—Ç —Å 1
            const cellAddress = `${colLetter}${rowNumber}`;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ü–≤–µ—Ç –∏–∑ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ —è—á–µ–µ–∫
            if (window.excelCellColors[cellAddress]) {
                return window.excelCellColors[cellAddress];
            }
            
            return null;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è input file
            document.getElementById('fileInput').addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    handleExcelFile(this.files[0]);
                }
            });
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ spa.xlsx –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–ª—è –õ–∞—Ä—ã –∏ –•—É–∞–Ω–∏—Ç—ã)
        function loadDefaultFile() {
            try {
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç XMLHttpRequest –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
                const xhr = new XMLHttpRequest();
                xhr.open('GET', 'spa.xlsx', true);
                xhr.responseType = 'arraybuffer';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                document.getElementById('loading').style.display = 'block';
                document.getElementById('statusMessage').className = 'status';
                document.getElementById('statusMessage').textContent = 'Loading default file...';
                
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        // –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω
                        const data = new Uint8Array(xhr.response);
                        const workbook = XLSX.read(data, { type: 'array', cellStyles: true });
                        
                        // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        
                        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ü–≤–µ—Ç–∞ —è—á–µ–µ–∫
                        const cellColors = extractCellColors(worksheet);
                        window.excelCellColors = cellColors;
                        
                        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ JSON
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: null, cellStyles: true });
                        
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                        displayData(jsonData);
                        
                document.getElementById('statusMessage').className = 'status success';
                        document.getElementById('statusMessage').textContent = 'Default file successfully loaded!';
                    } else {
                        // –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
                        console.error('Error loading file:', xhr.statusText);
                document.getElementById('statusMessage').className = 'status error';
                        document.getElementById('statusMessage').textContent = 'Error loading file: ' + xhr.statusText;
                    }
                    document.getElementById('loading').style.display = 'none';
                };
                
                xhr.onerror = function() {
                    // –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞
                    console.error('Network error while loading file');
                    document.getElementById('statusMessage').className = 'status error';
                    document.getElementById('statusMessage').textContent = 'Network error while loading file';
                    document.getElementById('loading').style.display = 'none';
                };
                
                xhr.send();
            } catch (error) {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫
                console.error('Error processing default file:', error);
                document.getElementById('statusMessage').className = 'status error';
                document.getElementById('statusMessage').textContent = 'Error: ' + error.message;
                document.getElementById('loading').style.display = 'none';
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤
        function formatWorkingHours(hours) {
            if (!hours || hours === "") return "";
            
            // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "9-5"), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
            if (hours.includes("-")) return hours;
            
            // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ, –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, "9" -> "9-5")
            if (!isNaN(hours) && hours.trim() !== "") {
                const startHour = parseInt(hours.trim());
                return `${startHour}-${startHour + 8}`;
            }
            
            // –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
            return hours;
        }
    </script>
</body>
</html>
